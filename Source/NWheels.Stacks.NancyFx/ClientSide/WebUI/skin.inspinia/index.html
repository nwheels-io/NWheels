<!DOCTYPE html>
<html ng-app="theApp" ng-controller="appStart">
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
HEAD, JS/CSS LINKS
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title ng-bind="translate(app.text) + ' | ' + translate(currentScreen.text)">LOADING . . .</title>
    <base href="##BASE_URL##" />

    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    
    <link href="app/skin/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="app/skin/assets/css/languages/languages.min.css" rel="stylesheet">
    <link href="app/skin/assets/font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/datapicker/datepicker3.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/datetimepicker/bootstrap-datetimepicker.min.css" rel="stylesheet">

    <!-- Toastr style -->
    <link href="app/skin/assets/css/plugins/toastr/toastr.min.css" rel="stylesheet">
    
    <!--script src="assets/plugins/datajs-1.1.1/datajs-1.1.1.js"></script-->
    
    <link href="app/skin/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="app/skin/assets/font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/chosen/chosen.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/colorpicker/bootstrap-colorpicker.min.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/cropper/cropper.min.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/switchery/switchery.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/jasny/jasny-bootstrap.min.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/nouslider/jquery.nouislider.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/datapicker/datepicker3.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/ionRangeSlider/ion.rangeSlider.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/ionRangeSlider/ion.rangeSlider.skinFlat.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/clockpicker/clockpicker.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/daterangepicker/daterangepicker.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/dropzone/basic.css" rel="stylesheet">
    <!--link href="app/skin/assets/css/plugins/dropzone/dropzone.css" rel="stylesheet"-->
    <link href="app/skin/assets/css/plugins/jqGrid/ui.jqgrid.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/jQueryUI/jquery-ui-1.10.4.custom.min.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/jquery-jsonview/jquery.jsonview.min.css" rel="stylesheet">
    <link href="app/skin/assets/css/animate.css" rel="stylesheet">
    <link href="app/skin/assets/css/style.css" rel="stylesheet">

    <!-- Data Tables -->
    <link href="app/skin/assets/css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/dataTables/dataTables.responsive.css" rel="stylesheet">
    <link href="app/skin/assets/css/plugins/dataTables/dataTables.tableTools.min.css" rel="stylesheet">

    <style>
        @media (min-width: 768px) {
            .b-col {
                float: right;
            }
        }
        .middle-box {
            max-width:500px;
        }
        .btn-md.btn-circle {
            width: 36px;
            height: 36px;
            border-radius: 23px;
        }
        .ibox-title.nested {
            border: none;
            padding: 15px 20px 0px 20px;
        }
        .ibox-content.standalone {
            border-top: 0;
            padding-top: 5px;
        }
        .ibox-content.nested {
            border: none;
            padding: 20px 20px 10px 20px;
        }
        .ibox-content.nested .ibox-title {
            border: 0;
            padding: 0;
        }
        .ibox-content.nested .ibox-content {
            border: 0;
            padding: 0;
        }
        .ibox-content .tabs-container {
            padding: 10px;
            background-color: #1e2f40;
            border-radius: 5px;            
        }
        .panel-heading i.fa {
            margin-right: 3px;
        }
        .alert .glyphicon{
            display:table-cell;
        }
        .alert div,
        .alert span{
            padding-left: 10px;
            display:table-cell;
        }
        .alert span.moreInfo {
            padding:0;
            margin:0;
            display: inline;
        }
        .alert span.techInfo {
            display: block;
            margin-top: 10px;
            padding: 0;
            font-size: 9pt;
        }
        .alert button {
            margin: 10px 5px 0 0;
        }
        .alert-dismissable .close {
            top: -10px;
            right: -30px;
        }    
        .ibox-title h2 {
            display: inline-block;
            margin: 0 0 7px;
            padding: 0;
            text-overflow: ellipsis;
            float: left;
        }
        .ui-jqgrid .jqgrid-overlay {
            position: absolute;
            height: 100%;
            width: 100%;
        }        
        .ui-state-highlight,
        .ui-widget-content .ui-state-highlight,        
        .ui-widget-header .ui-state-highlight {
            color: white;
            background: #47617A;
        }        
        .ui-state-highlight .editable {
            color: black;
            background-color: #C6F4DE;
        }        
        a.commandLink {
            font-weight: bold;
            text-decoration: underline;
        }
        h2.logo-name {
            color: #e0e0e0;
            font-size: 50px;
            font-weight: 800;
            letter-spacing: 0px;
            margin-bottom: 0px;
            margin-top: -10px;
        }
        .loginscreen.middle-box.userAlertBoxContainer {
            width: 400px;
        }
        .userAlertBox {
            background-color: white;
            margin: 0;
            padding: 20px;
            width: 400px;
            max-width: 400px;
            border-radius: 8px;
        }
        .userAlertBoxIcon {
            vertical-align: top;
            text-align: right;
            padding: 0;
            height: 100px;
        }
        .userAlertBoxContent {
            text-align: left;
            vertical-align: top;
        }
        .userAlertBoxContent h2 {
            padding-bottom: 10px;
            border-bottom: 1px solid #F3F3F4;
        }
        i.alert-field-icon {
            float: left;
            padding-top: 4px;
        }
        div.alert-field-contents {
            padding: 10px 15px 10px 15px;
            margin: 0;
        }
        div.modal-body-alert {
            padding:0;
        }
        .modal-body-alert h2 {
            padding:0;
            margin:0;
        }
        .jsonText {
            background-color: #FDFDFD;
            padding: 5px;
        }
        .jsonview .prop {
            font-weight: normal;
            text-decoration: none;
            color: #808080;
        }
        .jsonview .prop {
            font-weight: normal;
            color: #808080;
        }
        .jsonview .string {
            color: #0C7963;
        }
        .full-height {
            height:100vh;
        }
        .tabs-container.full-height > .nav-tabs > li > a {
            padding: 5px 10px 7px 10px;
            border-radius:0;
        }
        .tabs-container.full-height > .nav-tabs > li.active > a:hover {
            color: black;
        }
        .tabs-container.full-height > .nav-tabs > li > a:hover {
            color: white;
        }
        .compensateZeroPadding {
            padding: 5px 10px 5px 10px;
        }
        .form-control[readonly].fieldTypeEdit {
            background-color: white;
        }
        i.jqgDetailPaneIcon.expanded:before {
            content: "\f068";
        }     
        div.jqgDetailPane {
            display: none;
        }
        div.jqgDetailPane.expanded {
            display: block;
            margin-top: 5px;
            margin-right: 0;
            margin-bottom: 0;
            padding: 0 0 0 5px;
            border-left: 2px solid #DDDDDD;
            /*background-color: lightgray;*/
            color: gray;
        }
        div.jqgDetailPane > div.jqgDetailPaneScroll {
            overflow-x: auto;
            padding: 5px;
        }
        table.prop-grid {
            border-spacing: 1px;
            border-collapse: separate;
        }
        table.prop-grid td {
            border: none !important;
            font-size: 0.9em;
        }
        table.prop-grid td.prop-grid-section {
            font-weight: bold;
            font-size: 1.1em;
            color: black; 
        }
        table.prop-grid td.prop-grid-label {
            padding:2px 5px 2px 2px;
            text-align:right;
            color: gray; 
            white-space: nowrap;
        }
        table.prop-grid td.prop-grid-value {
            padding: 0;
            font-family: monospace;
            font-size: 1.1em;
            white-space: nowrap;
        }
        table.prop-grid td.prop-grid-value pre {
            margin:0;
            padding: 2px;
            font-family: monospace;
            font-size: 1.0em;
            white-space: pre;
            border-radius: 2px;
        }
        div.jqgDetailPane div.jsonText .jsonview,
        div.jqgDetailPane div.jsonText .jsonview li,
        div.jqgDetailPane div.jsonText .jsonview li a,
        div.jqgDetailPane div.jsonText .jsonview li span {
            white-space: nowrap !important;
        }
        .ui-jqgrid tr.jqgrow td {
            vertical-align: top !important;
        }
        .dropdown.editable .dropdown-cell {
            cursor: pointer;
        }
        .dropdown.editable i {
            margin: 5px;
        }
        .jqgrow .ui-icon {
            background-image: url("app/skin/assets/css/plugins/jQueryUI/images/ui-icons_222222_256x240_jqg.png");
        }
        .jqgrow.ui-state-highlight .ui-icon {
            background-image: url("app/skin/assets/css/plugins/jQueryUI/images/ui-icons_ffffff_256x240_jqg.png");
        }
        .jqGrid_wrapper.flat-style .gbox_grid {
            border: none !important;
        }
        .jqGrid_wrapper.flat-style .ui-jqgrid tr.ui-row-ltr td { 
            border-bottom-style: 1px solid black; 
        }
        .jqGrid_wrapper.flat-style .jsonText {
            background-color: transparent;
        }
        .jqGrid_wrapper.expandable-tree-mode tr.jqgrow:hover > td { 
            border-bottom: 1px solid red !important; 
        }
        .threadlog-ThreadSuccess {
            background-color: green;
            color: white;
        }
        .threadlog-ActivitySuccess {
            background-color: lghtgreen;
            color: blue;
        }
        tr.jqg_rowstyle_ThreadSuccess > td { color: #484848; background-color: #ECECEC; font-weight: bold !important; }
        tr.jqg_rowstyle_ThreadWarning > td { color: #CC6600; background-color: #ECECEC; font-weight: bold !important; }
        tr.jqg_rowstyle_ThreadError > td { color: #C90000; background-color: #ECECEC; font-weight: bold !important; }
        tr.jqg_rowstyle_ThreadCritical > td { color: #FF3300; background-color: #ECECEC; }
        tr.jqg_rowstyle_ActivitySuccess > td  { color: #484848; background-color: #F8F8F8; }
        tr.jqg_rowstyle_ActivityWarning > td { color: #CC6600; background-color: #F8F8F8; }
        tr.jqg_rowstyle_ActivityError > td { color:#C90000; background-color: #F8F8F8; }
        tr.jqg_rowstyle_ActivityCritical > td { color: #FF3300;background-color: #F8F8F8; }
        tr.jqg_rowstyle_LogDebug > td  { color: #A0A0A0; }  
        tr.jqg_rowstyle_LogVerbose > td  { color: #808080 ; }
        tr.jqg_rowstyle_LogInfo > td { color: #0000AF; font-weight: bold !important; }
        tr.jqg_rowstyle_LogWarning > td { color: #CC6600; font-weight: bold !important; }
        tr.jqg_rowstyle_LogError > td { color: #E00000; font-weight: bold !important; }
        tr.jqg_rowstyle_LogCritical > td { color: #FF3300; font-weight: bold !important; }
        tr.jqgrow i.row-icon { margin-left: 5px; margin-right: 3px; }
        
        #global_div_dropdown_popup {
              position: fixed;
              z-index: 2000;
              background-color: rgba(51, 51, 51, 0.56);
              padding-top: 20%;
        }
        
        .grid-inline-edit-control {
            border: none;
            width: 100%;
            background-color: #C6F4DE;        
        }
        
        .grid-inline-edit-dropdown-panel {
               background-color: #d2d2d2;
                border: 7px solid #1e2f40;
                border-radius: 7px;
                padding: 15px;
        }
        
        a.clickable-cell {
            font-weight:800;
            padding: 3px;
            border-bottom: 1px solid black;
        }

        a.clickable-cell:hover {
            color:white;
            background-color: red;
            border-bottom: 1px solid white;
            border-radius: 5px;        
        }

        .ui-state-highlight a.clickable-cell {
            color: white;
            border-bottom: 1px solid white;
        }

        .ui-state-highlight a.clickable-cell:hover {
            background-color: #51abc3;
            color:white;
        }
    </style>
</head>
<body 
    ng-class="{
        'pace-done': currentScreen && currentScreen.screenKind != 'SignInSignUp',
        'gray-bg': currentScreen && currentScreen.screenKind == 'SignInSignUp'
    }" 
    ng-style="{
        'background-color': (currentScreen && currentScreen.screenKind == 'SignInSignUp' ? '#f3f3f4' : undefined)
    }"
>
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    PAGE BODY
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <div id="wrapper" ng-if="app">
        <uidl-screen ng-if="currentScreen" uidl="currentScreen"></uidl-screen>
        <uidl-widget uidl="uidl.modalAlert"></uidl-widget>
        <uidl-ellipsis-lookup-search></uidl-ellipsis-lookup-search>
    </div>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL SCREEN
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="uidl-screen">
        <uidl-widget uidl="uidl.contentRoot"></uidl-widget>
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL SCREEN PART
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="uidl-screen-part">
        <uidl-widget uidl="uidl.contentRoot"></uidl-widget>
        <uidl-widget ng-repeat="popup in uidl.popupContents" uidl="popup"></uidl-widget>
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL USER ALERT - INLINE
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="uidl-user-alert-inline">
        <div ng-if="alert.current"
             class="alert alert-dismissable"
             ng-class="{
                'alert-info':alert.current.uidl.type==='Info',
                'alert-success':alert.current.uidl.type==='Success',
                'alert-warning':alert.current.uidl.type==='Warning',
                'alert-danger':alert.current.uidl.type==='Error'
             }"
             style="text-align:left;">
            <button ng-if="!alert.current.uidl.resultChoices.length" aria-hidden="true" class="close" type="button" ng-click="answerAlert('None')">×</button>
            <i class="fa fa-lg glyphicon"
               ng-class="{
                   'fa-info':alert.current.uidl.type==='Info',
                   'fa-check-square':alert.current.uidl.type==='Success',
                   'fa-exclamation-triangle':alert.current.uidl.type==='Warning',
                   'fa-times-circle':alert.current.uidl.type==='Error'
               }"></i>
            <span>
                {{getDisplayText()}}
                <span ng-if="alert.current.parameters.reason" class="moreInfo">
                    <br/>{{alert.current.parameters.reason}}
                </span>
                <br ng-if="alert.current.uidl.resultChoices.length" />
                <button ng-repeat="choice in alert.current.uidl.resultChoices"
                        class="btn btn-xs btn-primary"
                        ng-class="{
                            'btn-info':alert.current.uidl.type==='Info',
                            'btn-success':alert.current.uidl.type==='Success',
                            'btn-warning':alert.current.uidl.type==='Warning',
                            'btn-danger':alert.current.uidl.type==='Error'
                        }"
                        ng-click="answerAlert(choice);">
                    {{::translate(choice)}}
                </button>
                <span ng-if="alert.current.faultInfo" class="techInfo">
                    <a class="alert-link" data-toggle="modal" data-target="#divModalTechnicalInfo"><i class="fa fa-xs fa-angle-double-right"></i>&nbsp;technical info</a>
                </span>
            </span>
        </div>
    </script>
 
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL USER ALERT - TECHNICAL INFO POPUP
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <div class="modal inmodal" id="divModalTechnicalInfo" tabindex="-1" role="dialog" aria-hidden="true" style="display:none">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <i class="fa fa-bug modal-icon"></i>
                    <h4 class="modal-title">technical info</h4>
                </div>
                <div class="modal-body">
                    <pre style="height:500px;word-wrap:normal;">{{userAlertTechnicalInfo}}</pre>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    IFRAME FOR 'BEGIN DOWNLOAD' BEHAVIOR
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

    <iframe id="global_iframe_content_download" style="display:none;"></iframe>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    DIV FOR MODAL DROP-DOWNS
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

    <div id="global_div_dropdown_popup" style="display:none;"></div>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL USER ALERT - MODAL
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/ModalUserAlert">
        <div class="modal inmodal fade" id="divModal_{{uidl.elementName}}" tabindex="-1" role="dialog"  aria-hidden="true" data-backdrop="static">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <i  class="fa modal-icon pull-left" style="margin-top:-20px;"
                            ng-class="{
                               'fa-info':alert.uidl.type==='Info',
                               'fa-check-square':alert.uidl.type==='Success',
                               'fa-exclamation-triangle':alert.uidl.type==='Warning',
                               'fa-times-circle':alert.uidl.type==='Error'
                            }"></i>
                        <h6 class="modal-title" style="padding-right:50px;">
                            {{translate(alert.uidl.type)}}
                        </h6>
                    </div>
                    <div class="modal-body">
                        {{translate(alert.uidl.text)}}
                    </div>
                    <div class="modal-footer">
                        <button 
                            ng-repeat="choice in alert.uidl.resultChoices"
                            class="btn btn-w-m"
                            style="margin-left:5px;"
                            ng-class="{
                                'btn-info':alert.uidl.type==='Info',
                                'btn-success':alert.uidl.type==='Success',
                                'btn-warning':alert.uidl.type==='Warning',
                                'btn-danger':alert.uidl.type==='Error'
                            }"
                            ng-click="answerAlert(choice);">
                            {{::translate(choice)}}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </script>
    <script type="text/javascript">
        function initWidget_ModalUserAlert($scope) {
            $("#divModal_" + $scope.uidl.elementName).modal({backdrop: 'static', keyboard: false});
            $("#divModal_" + $scope.uidl.elementName).on('hidden', function () {
                answerAlert('Cancel');
            });
            $scope.$on($scope.uidl.qualifiedName + ':ShowModal', function () {
                $("#divModal_" + $scope.uidl.elementName).modal('show', {backdrop: 'static', keyboard: false});
            });
            $scope.$on($scope.uidl.qualifiedName + ':HideModal', function () {
                $("#divModal_" + $scope.uidl.elementName).modal('hide');
            });
        }
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - SPLASH
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/Splash">
        <div ng-if="uidl.utilityBar" class="row border-bottom" style="padding:10px;border:none !important;">
            <ul class="nav navbar-top-links navbar-right">
                <li class="dropdown" ng-repeat="widget in uidl.utilityBar.containedWidgets" style="margin-right:20px;">
                    <uidl-widget uidl="widget" ></uidl-widget>
                </li>
            </ul>
         </div>
        <div>
            <h1 class="logo-name" ng-if="!uidl.logoImage" style="text-align:center">{{::translate(uidl.text)}}</h1>
            <h1 class="logo-name" ng-if="uidl.logoImage" style="text-align:center"><img 
                ng-src="{{::uidl.logoImage}}" 
                alt="{{::translate(uidl.text)}}" 
                title="{{::translate(uidl.text)}}"></img></h1>
            <h2 class="logo-name" style="text-align:center;margin-bottom:40px;">{{::translate(uidl.helpText)}}</h2>
            <uidl-widget uidl="uidl.insideContent"></uidl-widget>
            <p ng-if="uidl.footerText" class="m-t m-b text-center">{{::translate(uidl.footerText)}}</p>
            <p ng-if="uidl.poweredBy" class="m-t m-b text-center"><small>{{::translate(uidl.poweredBy)}}</small></p>
        </div>
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - USER ALERT BOX
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/UserAlertBox">
        <div ng-if="model.State" class="middle-box text-center loginscreen animated fadeInDown userAlertBoxContainer">
            <div class="userAlertBox">
                <div class="row" style="margin:0;">
                    <div class="userAlertBoxIcon col-xs-1">
                        <h2 ng-class="{
                           'text-success':model.State.Type==='Info',
                           'text-info':model.State.Type==='Success',
                           'text-warning':model.State.Type==='Warning',
                           'text-danger':model.State.Type==='Error'
                        }"><i class="fa fa-lg glyphicon" ng-class="{
                           'fa-info-circle':model.State.Type==='Info',
                           'fa-check-square':model.State.Type==='Success',
                           'fa-exclamation-triangle':model.State.Type==='Warning',
                           'fa-times-circle':model.State.Type==='Error'
                        }"></i></h2>
                    </div>
                    <div class="userAlertBoxContent col-xs-11">
                        <h2>{{translate(model.State.Heading)}}</h2>
                        <div ng-if="model.State.Details">
                            <p ng-repeat="detail in model.State.Details" class="m-t m-b">{{translate(detail)}}</p>
                        </div>
                    </div>                
                </div>
                <p ng-if="model.State.Action" class="m-t m-b center">
                    <a ng-if="model.State.Action"
                       ng-click="invokeAction()"
                       class="commandLink m-b">{{translate(model.State.Action)}}</a>
                </p>
            </div>
        </div>
    </script>
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - USER LOGIN FORM
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/UserLoginForm">
        <div class="middle-box text-center loginscreen animated fadeInDown">
            <div>
                <div>
                    <h1 class="logo-name">AFP</h1>
                </div>
                <h2>Sign In</h2>
                <p ng-if="model.State.LoginFault!='PasswordExpired'">Log in to your account.</p>
                <form class="m-t" role="form" ng-if="model.State.LoginFault!='PasswordExpired'" id="{{::uidl.elementName}}" novalidate>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Your Name" required="" ng-model="model.Data.LoginName" name="loginName" id="{{::uidl.elementName}}_name">
                    </div>
                    <div class="form-group">
                        <input type="password" class="form-control" placeholder="Password" required="" ng-model="model.Data.Password" name="password" id="{{::uidl.elementName}}_password">
                    </div>
                    <button class="btn btn-primary block full-width m-b" ng-click="invokeCommand('LogIn')">{{translate('Login')}}</button>
                </form>
                <p ng-if="model.State.LoginFault=='PasswordExpired'">Please change your password.</p>
                <form class="m-t" role="form" ng-if="model.State.LoginFault=='PasswordExpired'" novalidate>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Your Name" required="" ng-model="model.Data.LoginName" >
                    </div>
                    <div class="form-group">
                        <input type="password" class="form-control" placeholder="Current Password" required="" ng-model="model.Data.Password" >
                    </div>
                    <div class="form-group">
                        <input type="password" class="form-control" placeholder="New Password" required="" ng-model="model.Data.NewPassword" >
                    </div>
                    <button class="btn btn-primary block full-width m-b" ng-click="invokeCommand('ChangePassword')">Change Password</button>
                </form>
            </div>                
            <uidl-user-alert-inline alert="inlineUserAlert"></uidl-user-alert-inline>
        </div>
    </script>
    <script type="text/javascript">
        function initWidget_UserLoginForm($scope) {
            $('#' + $scope.uidl.elementName).validate();
            $scope.invokeCommand = function(commandName) {
                if ($('#' + $scope.uidl.elementName).valid()===true) {
                    $scope.$emit($scope.uidl.qualifiedName + ':' + commandName + ':Executing');
                }
            };
        }
    </script>
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - CURRENT LOGGED-IN USER
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/LoggedInUserWidget">
        <a href="" ng-click="$emit(uidl.qualifiedName + ':LogOut:Executing')">
            <i class="fa fa-sign-out"></i> {{translate('LogOut')}}
        </a>
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - LANGUAGE SELECTOR
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/LanguageSelector">
        <div>
            <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                <span class="lang-sm lang-lbl-full" lang="{{currentLanguage}}"></span>
            </a>
            <ul class="dropdown-menu">
                <li ng-repeat="lang in allLanguages"><a ng-click="$emit(uidl.qualifiedName + ':Select:Executing', lang)"><span class="lang-sm lang-lbl-full" lang="{{lang}}"></span></a></li>
            </ul>
        </div>
    </script>
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - PROFILE PHOTO
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/UserProfilePhoto">
        <div class="dropdown profile-element"> 
            <span>
                <img ng-if="model.State.ProfilePhotoId" alt="image" class="img-circle" ng-src="app/entity/queryImage/{{uidl.entityName}}/{{model.State.ProfilePhotoId}}/{{uidl.imageTypeProperty}}/{{uidl.imageContentProperty}}">
                <img ng-if="!model.State.ProfilePhotoId" alt="No profile photo" class="img-circle" src="app/skin/assets/img/default_profile_photo.png">
            </span>
            <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                <span class="clear"> 
                    <span class="block m-t-xs">
                        <strong class="font-bold">{{model.State.PersonFullName}}</strong>
                    </span> 
                    <span class="text-muted text-xs block">{{model.State.UserType}}<b class="caret"></b></span> 
                </span>
            </a>
            <ul class="dropdown-menu animated fadeIn m-t-xs">
                <li ng-repeat="command in uidl.commands"><a ng-click="$emit(command.qualifiedName + ':Executing')">{{::translate(command.text)}}</a></li>
            </ul>
        </div>    
    </script>
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - MANAGEMENT CONSOLE
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/ManagementConsole">
        <nav class="navbar-default navbar-static-side" role="navigation">
            <div class="sidebar-collapse">
                <ul class="nav metismenu" id="side-menu">
                    <li class="nav-header">
                        <uidl-widget uidl="uidl.profilePhoto"></uidl-widget>
                    </li>
                    <li ng-repeat="item in copyOfMainMenu.items" ng-if="isUidlAuthorized(item)" ng-include="'app/uidl-element-template/ManagementConsole-menu-item'"></li>
                </ul>
            </div>
        </nav>

        <div id="page-wrapper" class="gray-bg">
            <div class="row border-bottom">
                <nav class="navbar navbar-static-top gray-bg" role="navigation" style="margin-bottom: 0; height: 63px; padding-top:3px;">
                    <div class="navbar-header">
                        <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
                        <form role="search" class="navbar-form-custom" action="search_results.html">
                            <div class="form-group">
                                <!--input type="text" placeholder="Search for something..." class="form-control" name="top-search" id="top-search"-->
                            </div>
                        </form>
                    </div>
                    <ul class="nav navbar-top-links navbar-right">
                        <li>
                            <h3 class="text-muted welcome-message" style="padding: 20px 10px 20px 10px;margin:0;">{{::translate(appScope.uidl.text)}}</h3>
                        </li>
                        <!--li class="dropdown">
                            <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                                <i class="fa fa-envelope"></i>  <span class="label label-warning">16</span>
                            </a>
                            <ul class="dropdown-menu dropdown-messages">
                                <li>
                                    <div class="dropdown-messages-box">
                                        <a href="profile.html" class="pull-left">
                                            <img alt="image" class="img-circle" src="img/a7.jpg">
                                        </a>
                                        <div class="media-body">
                                            <small class="pull-right">46h ago</small>
                                            <strong>Mike Loreipsum</strong> started following <strong>Monica Smith</strong>. <br>
                                            <small class="text-muted">3 days ago at 7:58 pm - 10.06.2014</small>
                                        </div>
                                    </div>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <div class="dropdown-messages-box">
                                        <a href="profile.html" class="pull-left">
                                            <img alt="image" class="img-circle" src="img/a4.jpg">
                                        </a>
                                        <div class="media-body ">
                                            <small class="pull-right text-navy">5h ago</small>
                                            <strong>Chris Johnatan Overtunk</strong> started following <strong>Monica Smith</strong>. <br>
                                            <small class="text-muted">Yesterday 1:21 pm - 11.06.2014</small>
                                        </div>
                                    </div>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <div class="dropdown-messages-box">
                                        <a href="profile.html" class="pull-left">
                                            <img alt="image" class="img-circle" src="img/profile.jpg">
                                        </a>
                                        <div class="media-body ">
                                            <small class="pull-right">23h ago</small>
                                            <strong>Monica Smith</strong> love <strong>Kim Smith</strong>. <br>
                                            <small class="text-muted">2 days ago at 2:30 am - 11.06.2014</small>
                                        </div>
                                    </div>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <div class="text-center link-block">
                                        <a href="mailbox.html">
                                            <i class="fa fa-envelope"></i> <strong>Read All Messages</strong>
                                        </a>
                                    </div>
                                </li>
                            </ul>
                        </li-->
                        <!--li class="dropdown">
                            <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                                <i class="fa fa-bell"></i>  <span class="label label-primary">8</span>
                            </a>
                            <ul class="dropdown-menu dropdown-alerts">
                                <li>
                                    <a href="mailbox.html">
                                        <div>
                                            <i class="fa fa-envelope fa-fw"></i> You have 16 messages
                                            <span class="pull-right text-muted small">4 minutes ago</span>
                                        </div>
                                    </a>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <a href="profile.html">
                                        <div>
                                            <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                            <span class="pull-right text-muted small">12 minutes ago</span>
                                        </div>
                                    </a>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <a href="grid_options.html">
                                        <div>
                                            <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                            <span class="pull-right text-muted small">4 minutes ago</span>
                                        </div>
                                    </a>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <div class="text-center link-block">
                                        <a href="notifications.html">
                                            <strong>See All Alerts</strong>
                                            <i class="fa fa-angle-right"></i>
                                        </a>
                                    </div>
                                </li>
                            </ul>
                        </li-->                        
                        <li ng-repeat="command in uidl.utilityCommands">
                            <button 
                                type="button"
                                class="btn btn-rounded"
                                style="margin-right:5px; margin-bottom:5px;"
                                ng-disabled="utilityCommandInProgress || !isUtilityCommandEnabled(command)"
                                ng-click="invokeUtilityCommand(command)"
                                ng-class="{'btn-default':command.severity=='Read','btn-primary':command.severity=='Change','btn-warning':command.severity=='Loose','btn-danger':command.severity=='Destroy','btn-lg':uidl.mode=='Standalone','btn-md':uidl.mode!='Standalone'}"
                            ><i ng-if="command.icon" class="fa fa-{{::command.icon}}">&nbsp;</i>{{::translate(command.text)}}</button>
                        </li>
                        <li ng-repeat="widget in uidl.statusBar.containedWidgets" ng-class="{'dropdown': widget.border==='DropDown'}">
                            <uidl-widget uidl="widget"></uidl-widget>
                        </li>
                     </ul>
                </nav>  
            </div>
            <div class="row wrapper border-bottom white-bg page-heading" style="padding-bottom:15px;margin-bottom:15px;">
                <div class="col-lg-10">
                    <h2>{{translate(mainContentScreenPart.text)}}</h2>
                    <ol class="breadcrumb">
                        <li><a href="##BASE_URL##">Home</a></li>
                        <li class="active"><strong>{{translate(mainContentScreenPart.text)}}</strong></li>
                    </ol>
                </div>
            </div>            
            <div class="wrapper wrapper-content  animated fadeInRight">
                <uidl-widget uidl="uidl.mainContent"></uidl-widget>
            </div>
        </div>
        <uidl-user-alert-inline alert="userAlert"></uidl-user-alert-inline>
    </script>
    <script type="text/javascript">
        function initWidget_ManagementConsole($scope){
            $scope.$timeout(function() {
                $('#side-menu').metisMenu();
                $('.navbar-minimalize').click(function () {
                    $("body").toggleClass("mini-navbar");
                    SmoothlyMenu();
                });
            });
        }
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - MANAGEMENT CONSOLE MENU ITEM
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/ManagementConsole-menu-item">
        <a ng-class="{bold: item.level==0}" ng-show="item.subItems.length==0" href="#" ng-click="$emit(item.notifications[1].qualifiedName, item.value)"><i ng-if="item.icon" style="width:19px;" class="fa fa-{{::item.icon}}"></i>{{::translate(item.text)}}</a>
        <a href="#" ng-show="::item.subItems.length > 0" ng-controller="menuSubItemsExpander" ng-click="toggleSubItems()">
            <i ng-if="item.icon" style="width:16px;" class="fa fa-{{::item.icon}}"></i>
            <span class="nav-label" ng-class="{bold: item.level==0}">{{::translate(item.text)}}</span>
            <span class="fa arrow"></span>
        </a>
        <ul class="nav nav-second-level collapse">
            <li ng-repeat="item in item.subItems" ng-if="isUidlAuthorized(item)" ng-include="'app/uidl-element-template/ManagementConsole-menu-item'"></li>
        </ul>
    </script>

    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - CONTAINER
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/Container">
        <uidl-widget ng-repeat="widget in uidl.containedWidgets" uidl="widget"></uidl-widget>
    </script>
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - LAYOUT HORIZONTAL
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/LayoutHorizontal">
        <table cellpadding="0" cellspacing="0" border="0" width="100%">
            <tr>
                <td style="vertical-align: top;" ng-repeat="widget in uidl.containedWidgets">
                    <uidl-widget uidl="widget"></uidl-widget>
                </td>
            </tr>
        </table>
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - SCREEN PART CONTAINER
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/ScreenPartContainer">
        <uidl-user-alert-inline alert="userAlert"></uidl-user-alert-inline>
        <uidl-screen-part ng-if="currentScreenPart" uidl="currentScreenPart"></uidl-screen-part>
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - TEXT
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/Text">
        <h2 ng-if="uidl.textSize==='HugeHeader'">{{translate(model.State.Contents)}}</h2>
        <h3 ng-if="uidl.textSize==='LargeHeader'">{{translate(model.State.Contents)}}</h3>
        <h4 ng-if="uidl.textSize==='Header'">{{translate(model.State.Contents)}}</h4>
        <span ng-if="uidl.textSize==='Normal'">{{translate(model.State.Contents)}}</span>
        <small ng-if="uidl.textSize==='HugeHeader'">{{translate(model.State.Contents)}}</small>
    </script>
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - JSON TEXT
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/JsonText">
        <div id="{{::uidl.elementName}}" class="jsonText" json-view></div>
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - PROPERTY GRID
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/PropertyGrid">
        <table class="prop-grid">
            <tbody>
                <tr>
                    <td class="prop-grid-label">Message</td>
                    <td class="prop-grid-value"><pre></pre></td>
                </tr>
                <tr>
                    <td class="prop-grid-label">Values</td>
                    <td class="prop-grid-value"><pre></pre></td>
                </tr>
                <tr>
                    <td class="prop-grid-label">Activity Stack</td>
                    <td class="prop-grid-value"><pre></pre></td>
                </tr>
                <tr>
                    <td class="prop-grid-label">Application Unit</td>
                    <td class="prop-grid-value"><pre></pre></td>
                </tr>
            </tbody>
        </table>
    </script>
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - GAUGE
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/Gauge">
        <div class="ibox float-e-margins">
            <div class="ibox-title" style="border-color: #1C84C6;">
                <span class="label label-success pull-right"></span>
                <h3>{{::translate(uidl.text)}}</h3>
            </div>
            <div ng-repeat="value in model.State.values" class="ibox-content text-right">
                <h3 ng-if="$first" class="pull-left">
                    <!--span class="label label-success">{{::translate(value.title)}}</span-->
                    <span ng-if="value.alertType" class="label label-warning"><i class="fa fa-warning"></i>&nbsp;{{::translate(value.alertText)}}</span>
                </h3>
                <h1 ng-if="$first" class="no-margins">{{::formatValue(uidl.values[$index].valueFormat, value.value)}}</h1>
                <!--span ng-if="!$first" class="label label-success pull-left">{{::translate(value.title)}}</span-->
                <h3 ng-if="!$first" class="no-margins">{{::formatValue(uidl.values[$index].valueFormat, value.value)}}</h3>
                <small>{{::translate(value.title)}}</small>
            </div>
            <!--div class="ibox-content text-right">
                <span class="label label-success pull-left">Last 7 days</span>
                <h3 class="no-margins">234,567</h3>
            </div>
            <div class="ibox-content text-right">
                <span class="label label-success pull-left">This month</span>
                <h3 class="no-margins">1,234,567</h3>
            </div-->
        </div>
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - STATIC TABLE
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/StaticTable">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h5>{{::translate(uidl.text)}}</h5>
                <div class="ibox-tools">
                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>
                    <a class="close-link">
                        <i class="fa fa-times"></i>
                    </a>
                </div>
            </div>        
            <div class="ibox-content">
                <div class="row">
                    <div class="col-lg-12">
                        <table class="table table-hover margin bottom" ng-if="ResultSet">
                            <thead>
                                <tr>
                                    <th ng-repeat="column in ::uidl.displayColumns" class="text-center" ng-attr-width="{{column.nestedWidget ? '50%' : undefined}}">{{::translate(column.title)}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="row in ResultSet" ng-init="thisRowIndex=$index;">
                                    <td ng-repeat="column in ::uidl.displayColumns" ng-class="{'text-left':column.columnType!='Number', 'text-center':column.columnType=='Number'}">
                                        <span ng-if="column.columnType==='Text'||column.columnType==='Enum'"><strong>{{::translate(row[column.expression])}}</strong></span>
                                        <span ng-if="column.columnType==='Number'"><strong>{{::uidlService.formatValue(column.format, row[column.expression])}}</strong></span>
                                        <!--span ng-if="column.columnType==='Number'"><strong>{{::row[column.expression]}}</strong></span-->
                                        <div ng-if="column.nestedWidget" ng-controller="cloneUidlWithUniqueId">
                                            <div ng-init="cloneUidl(column.nestedWidget, thisRowIndex)">
                                                <uidl-widget ng-if="thisUidl" uidl="thisUidl" parent-uidl="column" parent-model="(column.expression ? row[column.expression] : row)"></uidl-widget>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>                    
                    </div>
                </div>
            </div>
        </div>
    </script>
    <script type="text/javascript">
        function initWidget_StaticTable($scope) {
            $scope.$on($scope.uidl.qualifiedName + ':DataReceived', function (event, data) {
                $scope.ResultSet = data;
            });
        }
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - CRUD
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/Crud">
        <div class="row">
            <div ng-hide="uiShowCrudForm" class="col-lg-12">
                <div  ng-if="!uidl.disableToolBar" class="ibox-title" ng-class="{'standalone':uidl.mode==='Standalone', 'nested':uidl.mode!=='Standalone'}">
                    <button class="btn btn-primary btn-circle btn-outline" ng-class="{'btn-lg':uidl.mode==='Standalone', 'btn-md':uidl.mode!=='Standalone'}" style="margin-right:5px" type="button" ng-click="newEntity();" ng-disabled="commandInProgress" ng-show="entityAuth.create" title="Add New">
                        <i class="fa fa-plus"></i>
                    </button>
                    <button class="btn btn-success btn-circle btn-outline" ng-class="{'btn-lg':uidl.mode==='Standalone', 'btn-md':uidl.mode!=='Standalone'}" style="margin-right:5px" type="button" ng-click="editEntity(selectedEntity)" ng-disabled="commandInProgress || !selectedEntity" ng-show="entityAuth.update" title="Edit Selected">
                        <i class="fa fa-edit"></i>
                    </button>
                    <button class="btn btn-default btn-circle btn-outline" ng-class="{'btn-lg':uidl.mode==='Standalone', 'btn-md':uidl.mode!=='Standalone'}" style="margin-right:5px" type="button" ng-click="editEntity(selectedEntity)" ng-disabled="commandInProgress || !selectedEntity" ng-hide="entityAuth.update" title="View Details of Selected">
                        <i class="fa fa-search-plus"></i>
                    </button>
                    <button class="btn btn-danger btn-circle btn-outline" ng-class="{'btn-lg':uidl.mode==='Standalone', 'btn-md':uidl.mode!=='Standalone'}" style="margin-right:5px" type="button" ng-click="deleteEntity(selectedEntity)" ng-disabled="commandInProgress || !selectedEntity" ng-show="entityAuth.delete" title="Delete Selected">
                        <i class="fa fa-times"></i>
                    </button>
                    <button class="btn btn-default btn-circle btn-outline" ng-class="{'btn-lg':uidl.mode==='Standalone', 'btn-md':uidl.mode!=='Standalone'}" style="margin-right:5px" type="button" ng-click="refresh()" ng-disabled="commandInProgress" title="Refresh">
                        <i class="fa fa-refresh"></i>
                    </button>
                    <button 
                        ng-repeat="command in uidl.entityCommands"
                        type="button"
                        class="btn btn-rounded"
                        style="margin-right:5px;"
                        ng-disabled="commandInProgress || !selectedEntity || !isEntityCommandEnabled(command)"
                        ng-click="invokeEntityCommand(command)"
                        ng-class="{'btn-default':command.severity=='Read','btn-primary':command.severity=='Change','btn-warning':command.severity=='Loose','btn-danger':command.severity=='Destroy','btn-lg':uidl.mode=='Standalone','btn-md':uidl.mode!='Standalone'}"
                    ><i ng-if="command.icon" class="fa fa-{{::command.icon}}">&nbsp;</i>{{::translate(command.text)}}</button>
                    <button 
                        ng-repeat="command in uidl.staticCommands"
                        type="button"
                        class="btn btn-rounded btn-outline"
                        style="margin-right:5px;"
                        ng-disabled="commandInProgress"
                        ng-click="invokeStaticCommand(command)"
                        ng-class="{'btn-success':command.severity=='Read','btn-primary':command.severity=='Change','btn-warning':command.severity=='Loose','btn-danger':command.severity=='Destroy','btn-lg':uidl.mode=='Standalone','btn-md':uidl.mode!='Standalone'}"
                    ><i ng-if="command.icon" class="fa fa-{{::command.icon}}">&nbsp;</i>{{::translate(command.text)}}</button>
                </div>
                <div ng-if="!parentFormFieldHasModifier('FlatStyle')" class="ibox-content" ng-class="{'standalone':uidl.mode==='Standalone', 'nested':uidl.mode!=='Standalone'}">
                    <uidl-widget uidl="uidl.grid" parent-model="model"></uidl-widget>
                </div>
                <uidl-widget ng-if="parentFormFieldHasModifier('FlatStyle')" uidl="uidl.grid" parent-model="model"></uidl-widget>
            </div>
            
            <div ng-if="uiShowCrudForm" class="col-lg-12">
                <div class="ibox-title">
                    <h2 class="clearfix">
                        <i class="fa text-muted" ng-class="{'fa-asterisk':model.isNew, 'fa-edit':!model.isNew && entityAuth.update, 'fa-search-plus':!model.isNew && !entityAuth.update}"></i>
                        &nbsp;{{translate(uidl.entityName)}}
                    </h2>
                </div>
                <div class="ibox-content">
                    <uidl-widget ng-if="uidl.form" uidl="uidl.form"></uidl-widget>
                    <uidl-widget ng-if="uidl.formTypeSelector" uidl="uidl.formTypeSelector" parent-model="model"></uidl-widget>
                </div>
                <div class="ibox-content" style="padding-top:15px;">
                    <button 
                        ng-repeat="command in uidl.commands"
                        type="button"
                        class="btn btn-rounded"
                        style="margin-right:5px;"
                        ng-show="isCommandAuthorized(command)"
                        ng-disabled="commandInProgress"
                        ng-click="invokeCommand(command)"
                        ng-class="{'btn-success':command.severity=='Read','btn-primary':command.severity=='Change','btn-warning':command.severity=='Loose','btn-danger':command.severity=='Destroy','btn-lg':uidl.mode=='Standalone','btn-md':uidl.mode!='Standalone'}"
                    ><i ng-if="command.icon" class="fa fa-{{commandInProgress ? 'spinner' : command.icon}}">&nbsp;</i>{{::translate(command.text)}}</button>
                </div>
            </div>
            <div ng-if="uidl.popupContents">
                <uidl-widget ng-repeat="popup in uidl.popupContents" uidl="popup"></uidl-widget>
            </div>
        </div>
    </script>
    <script type="text/javascript">
        function initWidget_Crud($scope) {
            //...
        }
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - DATA GRID
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/DataGrid">     
        <div id="rdtwrapper_{{uniqueWidgetId}}" 
             class="jqGrid_wrapper" 
             ng-class="{'flat-style': uidl.flatStyle===true, 'expandable-tree-mode': uidl.expandableTreeMode===true, 'ng-hide': uidl.hiddenMode===true}">
            <table id="rdt_{{uniqueWidgetId}}"></table>
            <div ng-if="uidl.enablePaging" id="rdtpager_{{uniqueWidgetId}}"></div>
        </div>
    </script>
    <script type="text/javascript">
        function saveRowGrid(cntrl) {
            
            setTimeout(function () {
                var e = $.Event('keydown');                
                e.keyCode = 13; // Character 'A'
                
                $(cntrl).parents("td").focus();
                $(cntrl).parents("td").trigger(e);

            //    alert("Hello");
            }, 100);          
        }

        function cancelRowGrid(cntrl) {

            setTimeout(function () {
                var e = $.Event('keydown');
                e.keyCode = 27; // Character 'A'

                $(cntrl).parents("td").focus();
                $(cntrl).parents("td").trigger(e);

                //    alert("Hello");
            }, 100);
        }

        function initWidget_DataGrid($scope) {
            var columnsModel = [];
            var inlineEditorFields = null;
            if ($scope.uidl.inlineEditor) {
                var fields = $scope.uidl.inlineEditor.fields;
                inlineEditorFields = { };
                for (var i = 0 ; i < fields.length ; i++) {
                    inlineEditorFields[fields[i].propertyName] = fields[i];
                }
            }
            if ($scope.uidl.expandableTreeMode) {
                columnsModel.push({ name: '$id', index: '$id', width: 1, hidden: true, key: true });
            }
            if ($scope.uidl.isInlineEditEnabled === true) {
                columnsModel.push({
                    name:'actions',
                    index:'act',
                    width:100,
                    align:'center',
                    sortable:false,
                    formatter: function (cellvalue, options, rowObject) {
                        return '<i onclick="saveRowGrid(this)" class="fa fa-floppy-o" style="padding:3px 8px 3px 8px;cursor:pointer;">&nbsp;</i><i onclick="cancelRowGrid(this)" class="fa fa-undo" style="padding:3px 8px 3px 8px;cursor:pointer;">&nbsp;</i> <i class="fa fa-pencil" style="padding:3px 8px 3px 8px;cursor:pointer;">&nbsp;</i>';
                    }
                });       
            }
            $scope.gridColumns.forEach(function (metaColumn, idx) {
                if (metaColumn.columnType == 'Hidden' || !$scope.isUidlAuthorized(metaColumn)) {
                    return;
                }
                var colWidthPx = (
                    metaColumn.size==='Jumbo' ? 1040 : (
                    metaColumn.size==='ExtraLarge' ? 720 : (
                    metaColumn.size==='Large' ? 360 : (
                    metaColumn.size==='Small' ? 90 : 180))));
                var modelItem = {
                    name: metaColumn.expression,
                    label: $scope.translate(metaColumn.title),
                    index: metaColumn.expression,
                    editable: ($scope.uidl.isInlineEditEnabled===true && metaColumn.isEditSupported===true),
                    width: colWidthPx,
                    search: metaColumn.isFilterSupported===true,
                    sortable: metaColumn.isSortSupported===true,
                    //sorttype: column.dataType,
                };
                if (metaColumn.format) {
                    modelItem.formatter = function (cellvalue, options, rowObject) {
                        if (cellvalue!='Total:') {
                            return $scope.uidlService.formatValue(metaColumn.format, cellvalue);
                        } else {
                            return cellvalue;
                        }
                    };
                }
                switch (metaColumn.columnType) {
                    case 'Number':
                    case 'Key':
                        modelItem.align = 'right';
                        modelItem.searchoptions = {sopt: ['eq']};
                        //modelItem.stype = 'select';
                        //modelItem.searchoptions = {
                            //sopt: ['eq'],
                            //value: ':Any;1:GCM - Forex;2:GCM - Asia'
                            //dataInit: function(elem) {
                            //    $(elem).autocomplete({
                            //        source: ,
                            //        delay:0,
                            //        minLength:0
                            //    });
                            //}
                        //};
                        break;
                    case 'Enum':
                        modelItem.searchoptions = {sopt: ['cn']};
                        break;
                    case 'Image':
                        modelItem.searchoptions = {sopt: ['cn']};
                        modelItem.formatter = function(cellvalue, options, rowObject) {
                            return '<img src="' + cellvalue + '" style="max-width:' + colWidthPx + 'px;">';
                        };
                        break;
                    case 'Link':
                        modelItem.searchoptions = {sopt: ['cn']};
                        modelItem.formatter = function(cellvalue, options, rowObject) {
                            return '<a target="_blank" href="' + cellvalue + '" style="text-decoration:underline;">' + cellvalue + '</a>';
                        };
                        break;
                    case 'Widget':
                        modelItem.editable = false;
                        modelItem.search = false;
                        modelItem.formatter = function(cellvalue, options, rowObject) {
                            return '<a target="_blank" href="' + cellvalue + '" style="text-decoration:underline;">' + cellvalue + '</a>';
                        };
                        break;
                    case 'Type':
                        var metaType = $scope.uidlService.getMetaType($scope.uidl.entityName);
                        if (metaType && metaType.derivedTypeNames) {
                            var optionString = ':(All)';
                            for (var i = 0 ; i < metaType.derivedTypeNames.length ; i++) {
                                optionString += ';' + metaType.derivedTypeNames[i] + ':' + metaType.derivedTypeNames[i];
                            }
                            modelItem.stype = 'select';
                            modelItem.searchoptions = { 
                                sopt: ['eq'],
                                value: optionString, 
                                defaultValue: '' 
                            };
                        }
                        break;
                    case 'LookupMany':
                        if (metaColumn.itemDisplayAsExpression) {
                            modelItem.formatter = function(cellvalue, options, rowObject) {
                                if (Array.isArray(cellvalue)) {
                                    var text = '';
                                    for (var i = 0 ; i < cellvalue.length ; i++) {
                                        if (i > 0) {
                                            text += ', ';
                                        }
                                        if (cellvalue[i]) {
                                            text += cellvalue[i][metaColumn.itemDisplayAsExpression];
                                        }
                                        else {
                                            text += '?';
                                        }
                                    }
                                    return text;
                                }
                                return cellvalue;
                            };
                        }
                        break;
                    default:
                        modelItem.searchoptions = {sopt: ['cn']};
                }
                if (metaColumn.alignment) {
                    switch(metaColumn.alignment) {
                        case 'Center': modelItem.align = 'center'; break;
                        case 'Right': modelItem.align = 'right'; break;
                    }
                }
                if (metaColumn.clickable === true || metaColumn.clickablePropertyName) {
                    modelItem.formatter = function(cellvalue, options, rowObject) {
                        var isClickable = metaColumn.clickable;
                        if (!isClickable) {
                            isClickable = (rowObject[metaColumn.clickablePropertyName] === true);
                        }
                        if (isClickable) {
                            return '<a href="javascript:void(0);" class="clickable-cell" onclick="jqgrid_onRowCellClick()">' + cellvalue + '</a>';
                        }
                        return cellvalue;
                    };
                }
                if (modelItem.editable) {
                    var editorField = inlineEditorFields[metaColumn.expression];
                    if (editorField) {
                        modelItem.edittype = 'custom';
                        modelItem.editoptions = {
                            custom_element: function (value, options) {
                                var rowId = $scope.lastSelectedRowId;
                                var rowData = $scope.getDataByRowId(rowId);
                                var editEl = $(
                                    '<div class="editable">' + 
                                    '<uidl-form-field parent-uidl="formUidl" uidl="fieldUidl" entity="rowEntity" template-name="FormFieldGridInlineEditStyle" />' +
                                    '</div>'
                                );
                                var editorScope = $scope.compileEditorWidget(editorField, rowData, editEl);
                                if (editorField.nestedWidget) {
                                    $scope.$timeout(function() {
                                        editorScope.$broadcast(editorField.nestedWidget.qualifiedName + ':ModelSetter', rowData[metaColumn.expression]);
                                    });
                                }
                                return editEl;
                            },
                            custom_value: function ($elem, operation, value) {
                                if (operation === "get") {
                                    return $elem.val(); 
                                }
                            },
                        };
                    }
                }
                columnsModel.push(modelItem);
            });
            $scope.needSearchToolbar = (Enumerable.From(columnsModel).Any(function(col) { return (col.search || col.sortable); }));
            
            $scope.uidl.calculateHeight = function() {
                if ($scope.uidl.mode !== 'Standalone') {
                    return '100%';
                }      
                if (!$scope.uidl.$skin.deltaWindowHeight) {
                    var height = document.documentElement.clientHeight - $('#' + $scope.tableElementId).offset().top - 140;
                    return height;
                }
                var windowClientHeight = document.documentElement.clientHeight;
                var tableElement = $('#' + $scope.tableElementId); 
                var tableOffset = tableElement.offset();
                if (tableOffset.top > 0) {
                    var height = windowClientHeight - tableOffset.top - 2;
                    var isVisible = tableElement.is(':visible');
                    if (!isVisible) {
                        height -= ($scope.needSearchToolbar ? 45 : 23);
                    }
                    if ($scope.uidl.enablePaging) {
                        var pagerHeight = $('#' + $scope.pagerElementId).height();
                        if (pagerHeight > 0) {
                            height -= pagerHeight;
                        } else {
                            height -= 32;
                        }
                    }
                    return height;
                } else {
                    return null;
                }
            };

            $scope.defineElementIds = function() {
                $scope.tableElementId = 'rdt_' + $scope.uniqueWidgetId;
                $scope.pagerElementId = 'rdtpager_' + $scope.uniqueWidgetId;
                $scope.wrapperElementId = 'rdtwrapper_' + $scope.uniqueWidgetId;
            };

            $scope.getDataByRowId = function(rowId) {
                if ($.isNumeric(rowId)) {
                    var rowData = $scope.ResultSet[parseInt(rowId) - 1];
                    return rowData;
                } else {
                    var hashPosition = rowId.lastIndexOf('#');
                    var numericId = parseInt(rowId.substring(hashPosition + 1));
                    var rowData = $scope.ResultSet[numericId - 1];
                    return rowData;
                }
            }
            
            $scope.transformToAdjacentTreeModel = function(localResultSet, serverNode, parentServerNode, level) {
                var serverSubNodes = serverNode[$scope.uidl.subTreePropertyName];

                if ($scope.uidl.ignoreTreeNodeServerIds === true) {
                    serverNode['$id'] = '' + (localResultSet.length + 1);
                }
                
                serverNode['$treeParentId'] = (parentServerNode ? parentServerNode['$id'] : null);
                serverNode['$treeLevel'] = level;
                serverNode['$treeLeaf'] = (serverSubNodes && serverSubNodes.length > 0 ? false : true);
                serverNode['$treeExpanded'] = false;
                serverNode['loaded'] = true;
                localResultSet.push(serverNode);

                if (serverSubNodes) {
                    for (var i = 0; i < serverSubNodes.length; i++) {
                        $scope.transformToAdjacentTreeModel(localResultSet, serverSubNodes[i], serverNode, level + 1);
                    }
                }
                
                serverNode[$scope.uidl.subTreePropertyName] = null;
            };

            $scope.applyDataDrivenRowStyles = function(minIndex, maxIndex, minLevel, maxLevel) {
                minIndex = minIndex || 0;
                maxIndex = maxIndex || $scope.ResultSet.length;
                minLevel = minLevel || 0;
                maxLevel = maxLevel || 1000000;
                var table = $('#' + $scope.tableElementId)[0];
                var styleBackColors = { };
                for (var i = minIndex + 1; i <= maxIndex && i < table.rows.length; i++) {
                    var tr = table.rows[i];
                    var data = $scope.getDataByRowId(tr.id);
                    if ($scope.uidl.expandableTreeMode) {
                        if (data.$treeLevel < minLevel || data.$treeLevel > maxLevel) {
                            continue;
                        }
                    }
                    var cssClassName = 'jqg_rowstyle_' + data[$scope.uidl.rowStylePropertyName];
                    $(tr).addClass(cssClassName);
                    if ($scope.uidl.expandableTreeMode) {
                        if (!styleBackColors[cssClassName]) {
                            styleBackColors[cssClassName] = getCssRulePropertyValue('background-color', 'tr.' + cssClassName + ' > td');
                        }
                        var backColor = (styleBackColors[cssClassName] || 'transparent');
                        var td = $(tr.cells[1]);
                        td.addClass(cssClassName);
                        if (backColor !== 'transparent') {
                            var indent = 18 * (data.$treeLevel + 1) + 4; 
                            var backStyle = 'linear-gradient(90deg, transparent ' + indent + 'px, ' + backColor + ' ' + indent + 'px, ' + backColor + ')';
                            td.css('background-color', 'transparent');
                            td.css('background-image', backStyle);
                        }
                    }
                }
            };
            
            $scope.compileDetailPane = function(rowData, element) {
                var childScope = $scope.$rootScope.$new(true, $scope);
                childScope.uidl = $scope.uidl.detailPaneWidget;
                childScope.data = rowData;
                //rowData.$detailPaneScope = childScope;
                var template = '<uidl-widget uidl="uidl" parent-model="data"></uidl-widget>';
                element.html(template);
                $scope.$compile(element.contents())(childScope);
            };

            $scope.compileEditorWidget = function(fieldUidl, rowData, element) {
                var childScope = $scope.$rootScope.$new(true, $scope);
                childScope.formUidl = $scope.uidl.inlineEditor;
                childScope.fieldUidl = fieldUidl;
                childScope.rowEntity = rowData;
                $scope.$compile(element.contents())(childScope);
                childScope.$digest();
                cleanDom(element.children('.ng-isolate-scope')[0]);
                return childScope;
                //var fieldDirectiveEl = element.children('.ng-isolate-scope');
                //fieldDirectiveEl.contents().filter(function() { return this.nodeType !== 1; /*Node.ELEMENT_NODE*/ }).remove();
                //editEl.css({display: 'block'});
            };
            
            $scope.onDataReceived = function (event, data) {
                $scope.defineElementIds();
                $scope.ResultSet = data;
                for (var  i = 0; i < data.length; i++) {
                    data[i]['$index'] = i;
                }
                $scope.$timeout(function () {
                    $('#' + $scope.tableElementId).jqGrid('GridUnload');
                    $('#' + $scope.tableElementId).jqGrid({
                        datatype: 'local',
                        localReader: {
                           id: "$index",
                        },
                        data: data,
                        loadonce: true,
                        rownumWidth: 45,
                        shrinkToFit: false,
                        width: null,
                        height: '100%',
                        rowNum: 20,
                        rowList: $scope.uidl.pageSizeOptions || [10, 20, 30],
                        pager: "#rdtpager_" + $scope.uniqueWidgetId,
                        colModel: columnsModel,
                        gridview: true,
                        viewrecords: true,
                        add: false,
                        edit: false,
                        rownumbers: true,
                        hidegrid: false,
                        ignoreCase: true,
                        onSelectRow: function (rowId) {
                            var rowObject = $(this).getLocalRow(rowId);
                            var dataObject = Enumerable.From($scope.ResultSet).FirstOrDefault(null, '$.$index===' + rowObject['$index']);
                            if (dataObject) {
                                $scope.$emit($scope.uidl.qualifiedName + ':ObjectSelected', dataObject);
                            }
                        }
                    });
                    var grid = $('#' + $scope.tableElementId);
                    grid.parents('div.ui-jqgrid-bdiv').css('min-height', ($scope.uidl.mode === 'Standalone' ? '200px' : '100px'));
                    if ($scope.uidl.mode === 'Standalone') {
                        grid.jqGrid('filterToolbar',{ searchOnEnter: false, defaultSearch: "cn" });
                    }
                    //grid[0].addJSONData(data);
                });
            };
            $scope.$on($scope.uidl.qualifiedName + ':DataReceived', $scope.onDataReceived);
            $scope.onRequestPrepared = function (event, request) {
                $scope.defineElementIds();
                $scope.preparedRequest = request;
                $scope.$timeout(function () {
                    $('#' + $scope.tableElementId).jqGrid('GridUnload');
                    $scope.lastSelectedRowId = null;
                    $scope.totalsRowDisplayed = false;
                    var gridOptions = {
                        datatype: function(postData) {
                            if ($scope.dataGridQueryInProgress) {
                                return;
                            }
                            $scope.dataGridQueryInProgress = true;
                            var queryBuilder = ($scope.preparedRequest.query ? $scope.preparedRequest.query.clone() : new EntityQueryBuilder($scope.uidl.entityName, $scope.preparedRequest.url));
                            if (postData.sidx) {
                                queryBuilder.orderBy(postData.sidx, postData.sord==='asc');
                            }
                            for (var i = 0; i < $scope.gridColumns.length; i++) {
                                queryBuilder.select($scope.gridColumns[i].expression);
                                if ($scope.uidl.isInlineEditEnabled && inlineEditorFields) {
                                    var editorField = inlineEditorFields[$scope.gridColumns[i].expression];
                                    if (editorField && editorField.lookupDisplayProperty) {
                                        queryBuilder.include($scope.gridColumns[i].expression + '.' + editorField.lookupDisplayProperty);
                                    }
                                    if (editorField && editorField.lookupValueProperty) {
                                        queryBuilder.include($scope.gridColumns[i].expression + '.' + editorField.lookupValueProperty);
                                    }
                                    if (editorField && editorField.lookupQueryFilter) {
                                        for (var j = 0; j < editorField.lookupQueryFilter.length; j++) {
                                            queryBuilder.include(editorField.lookupQueryFilter[j].propertyName);
                                        }
                                    }
                                }
                            }
                            if (postData._search === true) {
                                var filterObject = JSON.parse(postData.filters);
                                for (var i = 0; i < filterObject.rules.length; i++) {
                                    var rule = filterObject.rules[i];
                                    var searchByPropertyName = null;
                                    for (var j = 0 ; j < $scope.gridColumns.length; j++) {
                                        if ($scope.gridColumns[j].expression === rule.field) {
                                            searchByPropertyName = $scope.gridColumns[j].searchPropertyName;
                                            break;
                                        }
                                    }
                                    queryBuilder.where(searchByPropertyName || rule.field, rule.data, rule.op);
                                }
                            }
                            queryBuilder.take(postData.rows);
                            queryBuilder.page(postData.page);
                            var requestUrl = queryBuilder.getQueryUrl();
                            var grid = $('#' + $scope.tableElementId);
                            grid[0].grid.beginReq();
                            $scope.$http.post(
                                requestUrl,
                                $scope.preparedRequest.data
                            ).then(
                                function(response){
                                    $scope.dataGridQueryInProgress = false;
                                    if (grid[0].grid) {
                                        grid[0].grid.endReq();
                                    }
                                    $scope.ResultSet = response.data.ResultSet;
                                    if ($scope.uidl.expandableTreeMode) {
                                        var adjacentModel = [ ];
                                        for (var i = 0; i < $scope.ResultSet.length ; i++) {
                                            $scope.transformToAdjacentTreeModel(adjacentModel, $scope.ResultSet[i], null, 0);
                                        }
                                        response.data.ResultSet = adjacentModel;
                                        $scope.ResultSet = adjacentModel;
                                    }
                                    $scope.entityService.trackRetrievedEntities(response.data.ResultSet);
                                    var thegrid = $('#' + $scope.tableElementId);
                                    thegrid[0].addJSONData(response.data);
                                    $scope.$emit($scope.uidl.qualifiedName + ':QueryCompleted', response.data);
                                    
                                    /*if ($scope.uidl.expandableTreeMode) {
                                        setTimeout(function() {
                                            console.log('REQUESTING ANOTHER THREAD LOG....');
                                            $scope.$http.post(
                                                'http://localhost:9411/app/api/RequestReply/EntityQuery/RootThreadLogUINode/TransactionScript/Transactions.AbstractThreadLogUINodesTx/Execute?$select=Text,TimeText,Node,DurationMs,DbDurationMs,DbCount,CpuTimeMs,LogId,CorrelationId&$take=10000&$page=1',
                                                {input: {Id: "6ffd600edb974a019f61b043d674c872", CorrelationId: null}}
                                            ).then(function(response){
                                                console.log('ADDING ANOTHER THREAD LOG....');
                                                var newAdjacentModel = [ ];
                                                for (var i = 0; i < response.data.ResultSet.length ; i++) {
                                                    $scope.transformToAdjacentTreeModel(newAdjacentModel, response.data.ResultSet[i], null, 0);
                                                }
                                                for (var i = 0; i < newAdjacentModel.length ; i++) {
                                                    var r = newAdjacentModel[i];
                                                    $scope.ResultSet.push(r);
                                                    thegrid.jqGrid('addChildNode', r.$id, r.$treeParentId, r);
                                                }
                                            });
                                        }, 5000);
                                    }*/
                                },
                                function(faultResponse){
                                    $scope.dataGridQueryInProgress = false;
                                    if (grid[0].grid) {
                                        grid[0].grid.endReq();
                                    }
                                    $scope.ResultSet = null;
                                    var faultInfo = $scope.commandService.createFaultInfo(faultResponse);
                                    $scope.$emit($scope.uidl.qualifiedName + ':QueryFailed', faultInfo);
                                }
                            );
                        },
                        jsonReader: {
                            total: 'PageCount',
                            page: 'PageNumber',
                            records: 'ResultCount',
                            root: 'ResultSet'
                        },
                        //height: ($scope.uidl.mode === 'Standalone' ? 350 : 150),
                        shrinkToFit: false,
                        width: null,
                        height: $scope.uidl.calculateHeight(),
                        rownumWidth: 45,
                        rowNum: ($scope.uidl.defaultPageSize || ($scope.uidl.pageSizeOptions && $scope.uidl.pageSizeOptions.length ? $scope.uidl.pageSizeOptions[0] : ($scope.uidl.mode === 'Standalone' ? 50 : 5))),
                        rowList: $scope.uidl.pageSizeOptions || [10, 20, 50],
                        pager: ($scope.uidl.enablePaging ? '#rdtpager_' + $scope.uniqueWidgetId : null),
                        colModel: columnsModel,
                        viewrecords: !$scope.uidl.expandableTreeMode,
                        rownumbers: !$scope.uidl.expandableTreeMode,
                        footerrow: ($scope.uidl.enableTotalRow===true),
                        add: false,
                        edit: false,
                        hidegrid: false,
                        loadui: 'block',
                        ignoreCase: true,
                        hoverrows: ($scope.uidl.expandableTreeMode!==true),
                        //afterInsertRow: function(rowid, rowdata, rowelem) {
                        //    console.log('afterInsertRow! ', rowid, rowdata, rowelem);
                        //},
                        beforeSelectRow: function(rowid, e) {
                            return ($scope.uidl.selectionMode !== 'Disabled');
                        },
                        onSelectRow: function (rowId) {
                            var rowObject = $scope.ResultSet[rowId - 1];
                            if ($scope.uidl.enableAutonomousQuery) {
                                $scope.$emit($scope.uidl.qualifiedName + ':ObjectSelected', rowObject);
                            } else {
                                $scope.$emit($scope.uidl.qualifiedName + ':ObjectSelectedByIndex', rowId - 1);
                            }
                            
                            if ($scope.uidl.isInlineEditEnabled) {
                                var gridObj = $('#' + $scope.tableElementId);
                                if (rowId && rowId!==$scope.lastSelectedRowId) { 
                                    gridObj.restoreRow($scope.lastSelectedRowId); 
                                }
                                $scope.lastSelectedRowId = rowId;
                                gridObj.editRow(rowId, true, null, null, 'clientArray', null, function(saveRowId, saveIsOK) {
                                    /*
                                    var editedRowData = gridObj.getRowData(rowId);
                                    for (var i = 0; i < $scope.gridColumns.length ; i++) {
                                        var column = $scope.gridColumns[i];
                                        if (column.isEditSupported===true) {
                                            var value = editedRowData[column.expression];
                                            $scope.uidlService.writeValueByNavigationPath(rowObject, column.navigations, value);
                                        }
                                    }
                                    */
                                    var rowData = $scope.getDataByRowId(rowId);
                                    $scope.$apply(function() {
                                        $scope.$emit($scope.uidl.qualifiedName + ':InlineSave:Executing', rowData);
                                    });
                                }); 
                            }
                        },
                        ondblClickRow: function (rowId) {
                            
                            $("#global_div_dropdown_popup").hide();
                            var rowObject = $scope.ResultSet[rowId - 1];
                            if ($scope.uidl.enableAutonomousQuery) {
                                $scope.$emit($scope.uidl.qualifiedName + ':EditRequested', rowObject);
                            } else {
                                $scope.$emit($scope.uidl.qualifiedName + ':EditRequestedByIndex', rowId - 1);
                            }
                        },
                        subGrid: ($scope.uidl.enableDetailPane===true),
                        subGridOptions: { expandOnLoad: ($scope.uidl.detailPaneExpanded===true) },
                        subGridRowExpanded: function(subgrid_id, row_id) {
                            var rowData = $scope.ResultSet[row_id - 1];
                            var element = $("#" + subgrid_id);
                            $scope.beginQueryDetailPaneData(rowData).then(function(details) {
                                $scope.compileDetailPane(details, element);
                                //if (!$scope.uidl.detailPaneExpanded) {
                                //    $scope.$digest();
                                //}
                            });
                        },
                        subGridRowColapsed: function(subgrid_id, row_id) {
                            return !($scope.uidl.detailPaneExpanded===true);
                        },
                        gridComplete: function () {
                            var grid = $('#' + $scope.tableElementId);
                            if ($scope.uidl.enableDetailPane && $scope.uidl.detailPaneExpanded) {
                                var rowIds = $('#' + $scope.tableElementId).getDataIDs();
                                $.each(rowIds, function (index, rowId) {
                                    grid.expandSubGridRow(rowId); 
                                });
                            }
                            if ($scope.uidl.enableTotalRow && !$scope.totalsRowDisplayed) {
                                var totalSpec = { };
                                var totalsQueryBuilder = (
                                    $scope.preparedRequest.query ? 
                                    $scope.preparedRequest.query.clone() : 
                                    new EntityQueryBuilder($scope.uidl.entityName, $scope.preparedRequest.url));
                                
                                $scope.gridColumns.forEach(function (metaColumn, idx) {
                                    if (idx===0) {
                                        totalSpec[metaColumn.expression] = 'Total:';
                                    } else if (metaColumn.includeInTotal) {
                                        totalSpec[metaColumn.expression] = '...';
                                        totalsQueryBuilder.select(metaColumn.expression, 'sum');
                                    }
                                });
                                grid.jqGrid("footerData", "set", totalSpec);
                                var totalsRequestUrl = totalsQueryBuilder.getQueryUrl();
                                $scope.$http.post(
                                    totalsRequestUrl,
                                    $scope.preparedRequest.data
                                ).then(
                                    function(response){
                                        $scope.gridColumns.forEach(function (metaColumn, idx) {
                                            if (metaColumn.includeInTotal) {
                                                totalSpec[metaColumn.expression] = response.data.ResultSet[0][metaColumn.expression];
                                            }
                                        });
                                        grid.jqGrid("footerData", "set", totalSpec);
                                        $scope.totalsRowDisplayed = true;
                                    },
                                    function(faultResponse){
                                        var faultInfo = $scope.commandService.createFaultInfo(faultResponse);
                                        $scope.$emit($scope.uidl.qualifiedName + ':QueryFailed', faultInfo);
                                    }
                                );
                                
                                grid.jqGrid("footerData", "set", totalSpec);
                                //if ($scope.uidl.totalRowOnTop) {
                                //    var gview = grid.closest("ui-jqgrid-view"); // get div#gview_list
                                //    $("div.ui-jqgrid-sdiv",gview[0]).after($("div.ui-jqgrid-bdiv",gview[0]));
                                //}
                            }
                            if ($(this).jqGrid('getGridParam', 'reccount') == 0)
                            {         
                                $(".jqgfirstrow").css("height","1px");
                            }
                            if ($scope.uidl.rowStylePropertyName) {
                                $scope.applyDataDrivenRowStyles(0, $scope.ResultSet.length - 1, 0, 1);
                                setTimeout(function() {
                                    $scope.applyDataDrivenRowStyles(1, $scope.ResultSet.length - 1, 2);
                                }, 500);
                            }
                        }
                    };
                    
                    if ($scope.defaultSortColumn) {
                        gridOptions.sortname = $scope.defaultSortColumn.expression;
                        gridOptions.sortorder = ($scope.defaultSortColumn.defaultSortAscending ? 'asc' : 'desc');
                    }
                    
                    if ($scope.uidl.expandableTreeMode) {
                        gridOptions.ExpandColumn = $scope.gridColumns[0].expression;
                        gridOptions.treeGrid = true;
                        gridOptions.treeGridModel = 'adjacency';
                        gridOptions.treeReader = {
                            level_field: '$treeLevel',
                            parent_id_field: '$treeParentId', 
                            leaf_field: '$treeLeaf',
                            expanded_field: '$treeExpanded'
                        };
                        if (gridOptions.subGrid) {
                            gridOptions.colModel = gridOptions.colModel.slice();
                            gridOptions.colModel[1].formatter = function (cellValue, options, rowObject) {
                                var indentPixels = 18 * (rowObject.$treeLevel + 1) + 4;
                                var iconHtml = '';
                                if ($scope.uidl.rowIconPropertyName) {
                                    var rowData = $scope.getDataByRowId(rowObject.$id);
                                    var iconNameClass = (rowData[$scope.uidl.rowIconPropertyName] ? 'fa-' + rowData[$scope.uidl.rowIconPropertyName] : '');
                                    iconHtml = '<i class="fa fa-fw row-icon ' + iconNameClass + '">&nbsp;</i>';
                                }
                                return (
                                    iconHtml + 
                                    cellValue + 
                                    '<br/><div class="jqgDetailPane" style="margin-left:' + indentPixels + 'px;"><div class="jqgDetailPaneScroll"></div></div>'
                                );
                            };
                            gridOptions.colModel.splice(2, 0, { 
                                name: '$expand', 
                                index: '$expand', 
                                label: '...',
                                width: 25, 
                                align: 'center',
                                resizable: false,
                                sortable: false,
                                search: false,
                                formatter: function (cellValue, options, rowObject) {
                                    return '<i class="fa fa-xs fa-plus jqgDetailPaneIcon" style="cursor:pointer;" onclick="jqgrid_onDetailPaneIconClick(event)"></i>';
                                }
                            });
                        }
                    }
                    
                    /*if ($scope.uidl.rowStylePropertyName) {
                        for (var i = 0; i < gridOptions.colModel.length; i++) {
                            var col = gridOptions.colModel[i];
                            if (col.hidden) {
                                continue;
                            }
                            var oldFormatter = col.formatter;
                            col.formatter = function (cellValue, options, rowObject) {
                                var formattedValue = (oldFormatter ? oldFormatter(cellValue, options, rowObject) : cellValue);
                                var rowData = $scope.getDataByRowId(rowObject.$id);
                                var rowStyle = rowData[$scope.uidl.rowStylePropertyName];
                                
                                return '<div class="jqg_row_style ' + rowStyle + '">' + formattedValue + '</div>';
                            };
                        }
                    }*/
                    
                    var grid = $('#' + $scope.tableElementId);
                    grid.jqGrid(gridOptions);
                    if ($scope.needSearchToolbar) {
                        grid.jqGrid('filterToolbar', { stringResult: true, searchOnEnter: false, defaultSearch: "cn" });
                    }
                    grid.parents('div.ui-jqgrid-bdiv').css('min-height', ($scope.uidl.mode === 'Standalone' ? '200px' : '100px'));
                    
                    $scope.$on($scope.uidl.qualifiedName + ':PageRefreshRequested', function (event, data) {
                        grid.trigger('reloadGrid');
                    });

                    if ($scope.uidl.$skin.deltaWindowHeight && !$scope.resizeHandlerInitialized) {
                        $scope.resizeTimer = null;
                        $scope.resizeTimerTickHandler = function() {
                            var newHeight = $scope.uidl.calculateHeight();
                            if (newHeight) {
                                $scope.lastCalculatedHeight = newHeight;
                                $('#' + $scope.tableElementId).setGridHeight(newHeight);
                            } else if (!$scope.lastCalculatedHeight) {
                                $scope.resizeTimer = setTimeout($scope.resizeTimerTickHandler, 100);
                            }
                        };
                        $scope.resizeHandler = function() {
                            if (!$('#' + $scope.tableElementId).is(':visible')) {
                                return;
                            }
                            var windowClientHeight = document.documentElement.clientHeight;
                            var windowClientHeightJq = $(window).height();
                            if ($scope.lastWindowClientHeight && $scope.lastWindowClientHeight === windowClientHeight && $scope.lastCalculatedHeight) {
                                return;
                            }
                            clearTimeout($scope.resizeTimer);
                            $scope.lastWindowClientHeight = windowClientHeight;
                            $scope.lastCalculatedHeight = null;
                            $scope.resizeTimer = setTimeout($scope.resizeTimerTickHandler, 100);
                        };
                        $(window).bind('resize', $scope.resizeHandler);
                        $scope.$on("$destroy", function() {
                            if ($scope.resizeTimer) {
                                clearTimeout($scope.resizeTimer);
                            }
                            $(window).unbind('resize', $scope.resizeHandler);
                        });
                        $scope.resizeHandlerInitialized = true;
                    }
                    
                    $scope.$on($scope.uidl.qualifiedName + ':PageRefreshRequested', function (event, data) {
                        grid.trigger('reloadGrid');
                    });
                });
            };
            $scope.$on($scope.uidl.qualifiedName + ':RequestPrepared', $scope.onRequestPrepared);
        }
        function jqgrid_onDetailPaneIconClick(event) {
            event = (event || window.event);
            event.stopPropagation();
            var target = $(event.target || event.srcElement);
            var rowTr = target.closest('tr');
            var gridTable = rowTr.closest('table');
            var paneDiv = rowTr.find('.jqgDetailPane');
            var widgetContainerDiv = paneDiv.children('div.jqgDetailPaneScroll');
            target.toggleClass('expanded');
            paneDiv.toggleClass('expanded');
            
            if (target.hasClass('expanded')) {
                var scopeEl = rowTr.closest('.ng-scope');
                var scope = scopeEl.scope();
                var rowId = rowTr[0].id;
                var rowData = scope.getDataByRowId(rowId);
                scope.beginQueryDetailPaneData(rowData).then(function(details) {
                    scope.compileDetailPane(details, widgetContainerDiv);
                    scope.$timeout(function() {
                        var ngInclude = widgetContainerDiv.children('ng-include');
                        ngInclude.contents().filter(function() { return this.nodeType == 3; /*Node.TEXT_NODE*/ }).remove();
                    });
                });
            } else {
                var childScope = widgetContainerDiv.scope();
                childScope.$destroy();
                widgetContainerDiv.empty();
            }
        };
        function jqgrid_onRowCellClick(event) {
            event = (event || window.event);
            event.stopPropagation();
            var target = $(event.target || event.srcElement);
            var rowTd = target.closest('td');
            var rowTr = rowTd.closest('tr');
            var scopeEl = rowTr.closest('.ng-scope');
            var scope = scopeEl.scope();
            var rowId = rowTr[0].id;
            var rowData = scope.getDataByRowId(rowId);
            var colIndex = rowTd.index();
            if (scope.uidl.expandableTreeMode===true) {
                colIndex--;
            }
            if (scope.uidl.enableDetailPane===true) {
                colIndex--;
            }
            var cellClickInfo = {
                Data: rowData,
                ColumnExpression: scope.gridColumns[colIndex].expression
            };
            scope.$emit(scope.uidl.qualifiedName + ':CellClicked', cellClickInfo);
        };
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - LOOKUP GRID
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/LookupGrid">
        <div class="jqGrid_wrapper">
            <table id="rdt_{{uniqueWidgetId}}"></table>
            <div id="rdtpager_{{uniqueWidgetId}}"></div>
        </div>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/LookupDualList">
        <table style="width:100%">
            <thead>
                <tr>
                    <th>Included</th>
                    <th>&nbsp;</th>
                    <th>Available</th>
                </tr>
            <thead>
            <tbody>
                <tr>
                    <td width="50%">
                        <select style="width: 100%;display:block;" size="10" 
                            multiple
                            ng-dblclick="excludeSelected()"
                            ng-model="selection.exclude" 
                            ng-options="item as item[parentUidl.lookupDisplayProperty] for item in model track by item['$id']">
                    </td>
                    <td style="padding:3px;">
                        <a ng-click="excludeSelected()"><i class="fa fa-lg fa-chevron-circle-right"></i></a>
                        <br/>
                        <a ng-click="includeSelected()"><i class="fa fa-lg fa-chevron-circle-left"></i></a>
                    </td>
                    <td width="50%">
                        <select style="width: 100%;display:block;" size="10" 
                            multiple
                            ng-dblclick="includeSelected()"
                            ng-model="selection.include" 
                            ng-options="item as item[parentUidl.lookupDisplayProperty] for item in ResultSet track by item['$id']">
                        </select>  
                    </td>
                </tr>
                <tr>
                    <td class="text-right"><a ng-click="excludeAll()">Exclude All <i class="fa fa-lg fa-chevron-circle-right"></i></a></td>
                    <td>&nbsp;</td>
                    <td><a ng-click="includeAll()"><i class="fa fa-lg fa-chevron-circle-left"></i> Include All</a></td>
                </tr>
            <tbody>
        </table>
    </script>
    <script type="text/javascript">
        function initWidget_LookupGrid($scope) {
        
            function initAsLookupGrid(data) {
                $scope.$timeout(function () {
                    $('#rdt_' + $scope.uniqueWidgetId).jqGrid('GridUnload');

                    var columnsModel = [];

                    columnsModel.push({
                        name: "isChecked",
                        label: "Select",
                        formatter: "checkbox",
                        formatoptions: { disabled: !$scope.editAuthorized },
                        edittype: "checkbox",
                        width: 80
                    });

                    $scope.gridColumns.forEach(function (metaColumn, idx) {
                        var colWidthPx = (
                            metaColumn.size==='Jumbo' ? 1040 : (
                            metaColumn.size==='ExtraLarge' ? 720 : (
                            metaColumn.size==='Large' ? 360 : (
                            metaColumn.size==='Small' ? 90 : 180))));
                        columnsModel.push({
                            name: metaColumn.expression,
                            label: $scope.translate(metaColumn.title),
                            index: metaColumn.expression,
                            editable: false,
                            width: colWidthPx,
                            //sorttype: metaColumn.dataType,
                            search: true
                        });
                    });

                    $("#rdt_" + $scope.uniqueWidgetId).jqGrid({
                        datatype: 'local',
                        localReader: {
                           id: '$id',
                        },
                        data: data,
                        height: 150,
                        shrinkToFit: false,
                        rownumWidth: 45,
                        width: null,
                        rowNum: 50,
                        rowList: [50, 100, 200],
                        colModel: columnsModel,
                        pager: "#rdtpager_" + $scope.uniqueWidgetId,
                        viewrecords: true,
                        rownumbers: true,
                        add: false,
                        edit: false,
                        hidegrid: false,
                        loadComplete: function () {
                            var rows = this.rows;
                            var rowCount = rows.length;
                            for (var i = 1; i < rowCount; i++) {
                                $(rows[i].cells[1]).click(function (e) {
                                    var id = $(e.target).closest('tr')[0].id;
                                    var isChecked = $(e.target).is(':checked');
                                    $scope.updateCheckboxModel(id, isChecked);
                                });
                            }
                        }
                    });
                });
            }
            
            function initAsDualList(data) {
                $scope.ResultSet = $scope.ResultSet.filter(function(r) {
                    var id = r['$id'];
                    var count = $scope.model.length;
                    for (var i = 0; i < count ; i++) {
                        if ($scope.model[i]['$id'] === id) {
                            return false;
                        }
                    }
                    return true;
                });
                $scope.selection = {
                    include: [],
                    exclude: []
                };
                
                $scope.includeAll = function() {
                    for (var i = 0 ; i < $scope.ResultSet.length ; i++) {
                        $scope.model.push($scope.ResultSet[i]);
                    }
                    $scope.ResultSet = [ ];
                    $scope.selection.include = [ ];
                    $scope.selection.exclude = [ ];
                };
                
                $scope.excludeAll = function() {
                    for (var i = 0 ; i < $scope.model.length ; i++) {
                        $scope.ResultSet.push($scope.model[i]);
                    }
                    $scope.model = [ ];
                    $scope.selection.include = [ ];
                    $scope.selection.exclude = [ ];
                };
                
                $scope.includeSelected = function() {
                    var addedIds = {};
                    var isExists = false;
                    for (var i = 0 ; i < $scope.selection.include.length ; i++) {
                        var item = $scope.selection.include[i];

                        angular.forEach($scope.model, function (value) {
                            if (value.Id == item.Id)
                            {
                                isExists = true;
                            }
                        });

                        if (isExists == false)
                        {
                            $scope.model.push(item);
                            addedIds[item['$id']] = true;
                        }
                    }
                    for (var i = 0 ; i < $scope.ResultSet.length ; ) {
                        var item = $scope.ResultSet[i];
                        if (addedIds[item['$id']]) {
                            $scope.ResultSet.splice(i, 1);
                        } else {
                            i++;
                        }
                    }
                };
                
                $scope.excludeSelected = function() {
                    var removedIds = {};
                    var isExists = false;
                    for (var i = 0 ; i < $scope.selection.exclude.length ; i++) {
                        var item = $scope.selection.exclude[i];
                        angular.forEach($scope.ResultSet, function (value) {
                            if (value.Id == item.Id) {
                                isExists = true;
                            }
                        });

                        if (isExists == false) {
                            $scope.ResultSet.push(item);
                            removedIds[item['$id']] = true;
                        }
                    }
                    for (var i = 0 ; i < $scope.model.length ; ) {
                        var item = $scope.model[i];
                        if (removedIds[item['$id']]) {
                            $scope.model.splice(i, 1);
                        } else {
                            i++;
                        }
                    }
                };
            }
            
            $scope.$on($scope.uidl.qualifiedName + ':DataReceived', function (event, data) {
                $scope.ResultSet = data;
                if ($scope.uidl.templateName === 'LookupGrid') {
                    initAsLookupGrid(data);
                } else if ($scope.uidl.templateName === 'LookupDualList') {
                    initAsDualList(data);
                }
            });
        }
    </script>
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL ELLIPSIS LOOKUP - MODAL
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/EllipsisLookupSearchModal">
        <div class="modal inmodal fade" id="divModal_EllipsisLookupSearchModal" tabindex="-1" role="dialog"  aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header" style="padding:15px">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <i class="fa modal-icon fa-search pull-left" style="font-size:28pt;"></i>
                        <h6 class="modal-title" style="padding-right:50px;">
                            Search Entity
                        </h6>
                    </div>
                    <div class="modal-body">
                        <uidl-widget ng-if="lookupContext" uidl="lookupContext.dataGridUidl"></uidl-widget>
                    </div>
                    <div class="modal-footer">
                        <button 
                            type="button"
                            class="btn btn-w-m btn-success"
                            ng-disabled="isSelectButtonDisabled()"
                            ng-click="lookupObjectSelected(selectedLookupObject)"
                        ><i class="fa fa-check">&nbsp;</i>Select</button>
                        <button 
                            type="button"
                            class="btn btn-w-m btn-warning"
                            ng-click="clearSelection()"
                        ><i class="fa fa-times">&nbsp;</i>Clear</button>
                        <button 
                            type="button"
                            class="btn btn-w-m btn-default"
                            ng-click="hideLookupSearchModal()"
                        >Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </script>
    <script type="text/javascript">
        function initWidget_EllipsisLookupSearchModal($scope) {
            $scope.unbindDataGridObjectSelected = null;
            $scope.selectedLookupObject = null;

            $scope.showLookupSearchModal = function() {
                $('#divModal_EllipsisLookupSearchModal').modal('show', {backdrop: 'static', keyboard: false});
            };
            $scope.hideLookupSearchModal = function() {
                $('#divModal_EllipsisLookupSearchModal').modal('hide');
            };
            $('#divModal_EllipsisLookupSearchModal').on('hidden.bs.modal', function() {
                $scope.$timeout(function() {
                    $scope.lookupContext = null;
                });
            });
            $scope.isSelectButtonDisabled = function() {
                return ($scope.selectedLookupObject===null);
            };
 
            $scope.$watch('lookupContext', function(newValue, oldValue) {
                $scope.selectedLookupObject = null;
            
                if ($scope.unbindDataGridObjectSelected) {
                    $scope.unbindDataGridObjectSelected();
                    $scope.unbindDataGridObjectSelected = null;
                }
                
                if (newValue) {
                    $scope.unbindDataGridObjectSelected = $scope.$on(newValue.dataGridUidl.qualifiedName + ':ObjectSelected', function(event, data) {
                        $scope.selectedLookupObject = data;
                        $scope.$apply();
                    });
                }
            });
        }
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - ENTITY METHOD FORM
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/EntityMethodForm">
        <div class="modal inmodal fade" id="divModal_{{uidl.elementName}}" tabindex="-1" role="dialog"  aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <i class="fa modal-icon fa-{{::uidl.icon}} pull-left" style="margin-top:-20px;"></i>
                        <h6 class="modal-title" style="padding-right:50px;">
                            {{translate(uidl.text)}}
                        </h6>
                    </div>
                    <div ng-class="{'modal-body': uidl.inputForm.templateName!='FormAlert', 'modal-body-alert': uidl.inputForm.templateName==='FormAlert' }">
                        <uidl-widget uidl="uidl.inputForm"></uidl-widget>
                    </div>
                    <div class="modal-footer">
                        <button 
                            ng-repeat="command in uidl.commands"
                            type="button"
                            class="btn btn-w-m"
                            style="margin-left:5px;"
                            ng-disabled="commandInProgress"
                            ng-click="invokeCommand(command)"
                            ng-class="{'btn-success':command.severity=='Read','btn-primary':command.severity=='Change','btn-warning':command.severity=='Loose','btn-danger':command.severity=='Destroy','btn-lg':uidl.mode=='Standalone','btn-md':uidl.mode!='Standalone'}"
                        ><i ng-if="command.icon" class="fa fa-{{::command.icon}}">&nbsp;</i>{{::translate(command.text)}}</button>
                    </div>
                </div>
            </div>
        </div>
    </script>
    <script type="text/javascript">
        function initWidget_EntityMethodForm($scope) {
            $scope.$on($scope.uidl.qualifiedName + ':ShowModal', function () {
                $("#divModal_" + $scope.uidl.elementName).modal('show');
            });
            $scope.$on($scope.uidl.qualifiedName + ':HideModal', function () {
                $("#divModal_" + $scope.uidl.elementName).modal('hide');
            });
        }
    </script>
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - TRANSACTION FORM
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/TransactionForm">
        <div class="panel panel-success">
            <div class="panel-heading">
                <i ng-if="uidl.icon" class="fa fa-{{::uidl.icon}}"></i> {{::translate(uidl.text)}}
            </div>
            <div ng-if="uidl.inputForm" class="panel-body">
                <uidl-widget uidl="uidl.inputForm" parent-model="model.State.Input"></uidl-widget>
            </div>
            <uidl-widget ng-if="uidl.inputFormTypeSelector" uidl="uidl.inputFormTypeSelector" parent-model="model.State"></uidl-widget>
        </div>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/TransactionFormFlatStyle">
        <div class="panel-body">
            <div ng-if="uidl.inputForm">
                <div ng-hide="model.State.Output">
                    <uidl-widget uidl="uidl.inputForm" parent-model="model.State.Input"></uidl-widget>
                </div>
            </div>
            <div ng-if="uidl.inputFormTypeSelector">
                <div ng-hide="model.State.Output">
                    <uidl-widget uidl="uidl.inputFormTypeSelector" parent-model="model.State"></uidl-widget>
                </div>
            </div>
            <div ng-if="uidl.outputForm">
                <div ng-show="model.State.Output">
                    <uidl-widget uidl="uidl.outputForm" parent-model="model.State.Output"></uidl-widget>
                </div>
            </div>
        </div>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/TransactionFormLoginStyle">
        <div class="middle-box text-center loginscreen animated fadeInDown" style="padding-top:0;">
            <h2>{{::translate(uidl.text)}}</h2>
            <div ng-hide="model.State.Output">
                <p ng-if="uidl.helpText">{{::translate(uidl.helpText)}}</p>
                <uidl-widget uidl="uidl.inputForm" parent-model="model.State.Input"></uidl-widget>
            </div>                
            <div ng-if="uidl.outputForm">
                <div ng-show="model.State.Output">
                    <uidl-widget uidl="uidl.outputForm" parent-model="model.State.Output"></uidl-widget>
                </div>
            </div>                
            <uidl-user-alert-inline alert="inlineUserAlert"></uidl-user-alert-inline>
        </div>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/TransactionFormSignUpStyle">
        <div class="middle-box text-center loginscreen animated fadeInDown" style="width:500px;padding-top:0px;">
            <div style="width:500px;">
                <div class="ibox-title" style="text-align:center">    
                    <h2>{{::translate(uidl.text)}}</h2>
                    <p ng-if="uidl.helpText" class="pull-right">{{::translate(uidl.helpText)}}</p>
                </div>
                <div class="ibox-content">
                    <uidl-widget uidl="uidl.inputForm" parent-model="model.State.Input"></uidl-widget>
                </div>
            </div>                
            <uidl-user-alert-inline alert="inlineUserAlert"></uidl-user-alert-inline>
        </div>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/TransactionFormInline">
        <div>
            <uidl-widget ng-if="uidl.inputForm" ng-hide="model.State.Output" uidl="uidl.inputForm" parent-model="model.State.Input"></uidl-widget>
            <uidl-widget ng-if="uidl.inputFormTypeSelector" ng-hide="model.State.Output" uidl="uidl.inputFormTypeSelector" parent-model="model.State"></uidl-widget>
            <uidl-widget ng-if="uidl.outputForm" ng-show="model.State.Output" uidl="uidl.outputForm" parent-model="model.State.Output"></uidl-widget>
        </div>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/TransactionFormPopupMode">
        <div class="modal inmodal fade" id="divModal_{{uidl.elementName}}" tabindex="-1" role="dialog"  aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <i class="fa modal-icon fa-{{::uidl.icon}} pull-left" style="margin-top:-20px;"></i>
                        <h6 class="modal-title" style="padding-right:50px;">
                            {{translate(uidl.text)}}
                        </h6>
                    </div>
                    <div class="modal-body" ng-hide="model.State.Output">
                        <uidl-widget uidl="uidl.inputForm" parent-model="model.State.Input"></uidl-widget>
                    </div>
                    <div class="modal-footer" ng-hide="model.State.Output">
                        <button 
                            ng-repeat="command in uidl.commands"
                            type="button"
                            class="btn btn-w-m"
                            style="margin-left:5px;"
                            ng-disabled="commandInProgress"
                            ng-click="invokeCommand(command)"
                            ng-class="{'btn-success':command.severity=='Read','btn-primary':command.severity=='Change','btn-warning':command.severity=='Loose','btn-danger':command.severity=='Destroy','btn-lg':uidl.mode=='Standalone','btn-md':uidl.mode!='Standalone'}"
                        ><i ng-if="command.icon" class="fa fa-{{::command.icon}}">&nbsp;</i>{{::translate(command.text)}}</button>
                    </div>
                    <div class="modal-body" ng-if="uidl.outputForm" ng-show="model.State.Output">
                        <uidl-widget uidl="uidl.outputForm" parent-model="model.State.Output"></uidl-widget>
                    </div>
                    <div class="modal-footer" ng-if="uidl.outputForm" ng-show="model.State.Output">
                        <button 
                            type="button"
                            class="btn btn-w-m btn-success btn-md"
                            style="margin-left:5px;"
                            ng-click="hideModal()"
                        ><i class="fa fa-check">&nbsp;</i>{{::translate('Close')}}</button>
                    </div>
                </div>
            </div>
        </div>
    </script>
    <script type="text/javascript">
        function initWidget_TransactionForm($scope) {
            if ($scope.uidl.inputForm && $scope.uidl.inputForm.isModalPopup) {
                $scope.$on($scope.uidl.qualifiedName + ':ShowModal', function () {
                    if ($scope.model.State) {
                        $scope.model.State.Output = null;
                    }
                    $("#divModal_" + $scope.uidl.elementName).modal('show');
                });
                $scope.$on($scope.uidl.qualifiedName + ':HideModal', function () {
                    $("#divModal_" + $scope.uidl.elementName).modal('hide');
                });
            }
        }
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - FORM
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/Form">
        <form class="form-horizontal" id="{{::uidl.elementName}}">
            <fieldset ng-disabled="commandInProgress">
            <!-- PLAIN FIELDS SINGLE COLUMN LAYOUT -->
            <div ng-if="plainFields.length <= 4" class="form-group" style="margin-bottom:0px;" ng-repeat="field in plainFields">
                <label class="control-label"
                       ng-class="{'col-lg-2':!uidl.isModalPopup, 'col-lg-4':uidl.isModalPopup}"
                       for="{{::uidl.elementName + '_' + field.propertyName}}">{{::translate(field.label)}}</label>
                <div ng-class="{
                    'col-lg-3':!uidl.isModalPopup && field.fieldType!='Alert' && !fieldHasModifier(field, 'Memo') && !fieldHasModifier(field, 'FlatStyle'), 
                    'col-lg-6':uidl.isModalPopup || field.fieldType==='Alert' || fieldHasModifier(field, 'Memo') || fieldHasModifier(field, 'FlatStyle')}"
                >
                    <uidl-form-field parent-uidl="uidl" uidl="field" entity="model.Data.entity" />
                    <!--span class="help-block m-b-none">Example block-level help text here.</span-->
                </div>
            </div>
            <!-- PLAIN FIELDS TWO-COLUMN LAYOUT -->
            <div ng-if="plainFields.length > 4" class="form-group" style="margin-bottom:0px;" ng-repeat="field in plainFields | twoColumnRows">
                <label class="col-lg-2 control-label"
                       for="{{::uidl.elementName + '_' + field.propertyName}}">{{::translate(field.label)}}</label>
                <div class="col-lg-3">
                    <uidl-form-field parent-uidl="uidl" uidl="field" entity="model.Data.entity" />
                    <!--span class="help-block m-b-none">Example block-level help text here.</span-->
                </div>
                <label ng-if="field['$nextCol']"
                       class="col-lg-2 control-label"
                       for="{{::uidl.elementName + '_' + field['$nextCol'].propertyName}}">{{::translate(field['$nextCol'].label)}}</label>
                <div ng-if="field['$nextCol']" class="col-lg-3">
                    <uidl-form-field parent-uidl="uidl" uidl="field['$nextCol']" entity="model.Data.entity" />
                    <!--span class="help-block m-b-none">Example block-level help text here.</span-->
                </div>
            </div>
            <!-- SECTIONS -->
            <div ng-if="sectionFields.length" class="panel-group"  style="margin-top:20px;">
                <div class="panel panel-default" ng-repeat="field in sectionFields" ng-controller="formNestedObject">
                    <div class="panel-heading" ng-init="isExpanded=$first;">
                        <h5 class="panel-title">
                            <input type="checkbox" ng-if="isNullable" ng-model="nestedObjectExists" ng-model-options="{ getterSetter: true }" />
                            <a data-toggle="collapse" 
                               data-parent="#accordion" 
                               href="{{::('#' + uidl.elementName + '_section' + $index)}}"
                               ng-click="isExpanded=!isExpanded">{{::translate(field.label, { upperCase: true })}}</a>
                        </h5>
                    </div>
                    <div id="{{::(uidl.elementName + '_section' + $index)}}" class="panel-collapse collapse" ng-class="{in: $first}">
                        <div class="panel-body">
                            <div ng-hide="nestedObjectExists()">
                                Turned off. Toggle checkbox above to turn on.
                            </div>
                            <div ng-show="nestedObjectExists()">
                                <uidl-widget ng-if="field.nestedWidget" uidl="field.nestedWidget" parent-uidl="field" parent-model="model.Data.entity"></uidl-widget>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- TABS -->
            <div ng-if="tabSetFields.length && uidl.fields.length > 1" class="tabs-container" style="margin-top:20px;">
                <ul class="nav nav-tabs">
                    <li ng-class="{active: $index == tabSetIndex}" ng-repeat="field in tabSetFields"><a ng-click="selectTab($index)">{{translate(field.label)}}</a></li>
                </ul>
                <div class="tab-content">
                    <div ng-repeat="field in tabSetFields" ng-class="{'tab-pane': true, active: $index == tabSetIndex}" ng-show="$index == tabSetIndex">
                        <div class="ibox-content nested">
                            <uidl-widget ng-if="field.nestedWidget" uidl="field.nestedWidget" parent-uidl="field" parent-model="model.Data.entity"></uidl-widget>
                        </div>
                    </div>
                </div>
            </div>
            <!-- TAB FLATTENED (when it is the only field in the form) -->
            <div ng-if="tabSetFields.length && uidl.fields.length == 1" ng-init="singleTabField=tabSetFields[0]">
                {{::translate(singleTabField.label)}}
                <uidl-widget ng-if="singleTabField.nestedWidget" uidl="singleTabField.nestedWidget" parent-uidl="singleTabField" parent-model="model.Data.entity"></uidl-widget>
            </div>
            <!-- COMMAND BUTTONS -->
            <div ng-if="uidl.commands.length && !uidl.autoSubmitOnChange" class="form-group">
                <div class="col-lg-5 clearfix">
                    <button ng-repeat="command in uidl.commands | reverse"
                            type="button"
                            class="btn btn-rounded btn-lg pull-right"
                            style="margin-right:5px;"
                            ng-disabled="commandInProgress"
                            ng-class="{'btn-success':command.severity=='Read','btn-primary':command.severity=='Change','btn-warning':command.severity=='Loose','btn-danger':command.severity=='Destroy'}"
                            ng-click="invokeCommand(command)"><i ng-if="command.icon" class="fa fa-{{::command.icon}}">&nbsp;</i>{{::translate(command.text)}}</button>
                </div>
            </div>
            </fieldset>
        </form>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/FormAlert">
        <form class="form-inline" id="{{::uidl.elementName}}">
            <!-- PLAIN FIELDS SINGLE COLUMN LAYOUT -->
            <div class="form-group" ng-repeat="field in plainFields" style="margin-bottom:0;display:block;">
                <uidl-form-field parent-uidl="uidl" uidl="field" entity="model.Data.entity" template-name="FormFieldAlertStyle" />
            </div>
        </form>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/FormAlertBig">
        <form class="form-inline" id="{{::uidl.elementName}}">
            <!-- PLAIN FIELDS SINGLE COLUMN LAYOUT -->
            <div class="form-group" ng-repeat="field in plainFields" style="margin-bottom:0;display:block;">
                <uidl-form-field parent-uidl="uidl" uidl="field" entity="model.Data.entity" template-name="FormFieldAlertStyleBig" />
            </div>
            <div ng-repeat="command in uidl.commands" class="m-b">
                <button ng-if="command.uiStyle != 'Link'"
                        class="btn block full-width m-b"
                        ng-class="{'btn-primary':command.severity!='None', 'btn-white':command.severity=='None'}"                    
                        ng-disabled="commandInProgress"
                        ng-click="invokeCommand(command)"><i ng-if="command.icon" class="fa fa-{{::command.icon}}">&nbsp;</i>{{::translate(command.text)}}</button>
                <a ng-if="command.uiStyle == 'Link'"
                   ng-disabled="commandInProgress" 
                   ng-click="invokeCommand(command)"
                   class="commandLink"><i ng-if="command.icon" class="fa fa-{{::command.icon}}">&nbsp;</i>{{::translate(command.text)}}</a>
            </div>
        </form>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/FormInline">
        <form class="form-inline" id="{{::uidl.elementName}}" style="margin-bottom:5px;">
            <!-- PLAIN FIELDS SINGLE COLUMN LAYOUT -->
            <div class="form-group" ng-repeat="field in plainFields" style="margin-bottom:0">
                <label for="{{::uidl.elementName + '_' + field.propertyName}}" 
                       style="position:relative;margin-right:5px;"
                       ng-class="{'m-l': !$first}"
                       ng-style="{top: (uidl.$skin.zeroPadding ? '3px' : '-5px')}">{{::translate(field.label, { upperCase: true })}}</label>
                <uidl-form-field parent-uidl="uidl" uidl="field" entity="model.Data.entity" />
            </div>
            <!-- COMMAND BUTTONS -->
            <div ng-if="uidl.commands.length && !uidl.autoSubmitOnChange" class="form-group m-l" style="margin-top:5px;">
                <button ng-repeat="command in uidl.commands | reverse"
                        type="button"
                        class="btn btn-rounded btn-md pull-right"
                        style="margin-right:5px;"
                        ng-disabled="commandInProgress"
                        ng-class="{'btn-success':command.severity=='Read','btn-primary':command.severity=='Change','btn-warning':command.severity=='Loose','btn-danger':command.severity=='Destroy'}"
                        ng-click="invokeCommand(command)"><i ng-if="command.icon" class="fa fa-{{::command.icon}}">&nbsp;</i>{{::translate(command.text)}}</button>
            </div>
        </form>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/FormBigFrontEnd">
        <form class="form-horizontal" id="{{::uidl.elementName}}">
            <!-- PLAIN FIELDS SINGLE COLUMN LAYOUT -->
            <div class="form-group" ng-repeat-start="field in plainFields" style="margin-bottom:0">
                <label class="control-label col-sm-4"
                       for="{{::uidl.elementName + '_' + field.propertyName}}">{{::translate(field.label, { upperCase: true })}}</label>
                <div class="col-sm-8"><uidl-form-field parent-uidl="uidl" uidl="field" entity="model.Data.entity" /></div>
            </div>
            <div ng-repeat-end class="hr-line-dashed"></div>
            <!-- COMMAND BUTTONS -->
            <div ng-if="uidl.commands.length && !uidl.autoSubmitOnChange" class="form-group">
                <div class="col-sm-8 col-sm-offset-4">
                    <button ng-repeat="command in uidl.commands"
                            type="button"
                            class="btn"
                            style="margin-right: 5px;"
                            ng-disabled="commandInProgress"
                            ng-class="{'btn-success':command.severity=='Read','btn-primary':command.severity=='Change','btn-warning':command.severity=='Loose','btn-danger':command.severity=='Destroy', 'btn-white':command.severity=='None'}"
                            ng-click="invokeCommand(command)"><i ng-if="command.icon" class="fa fa-{{::command.icon}}">&nbsp;</i>{{::translate(command.text)}}</button>
                </div>
            </div>
        </form>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/FormBigFrontEndFullScreen">
        <form class="form-horizontal" id="{{::uidl.elementName}}">
            <!-- PLAIN FIELDS SINGLE COLUMN LAYOUT -->
            <div class="form-group" ng-repeat-start="field in plainFields" style="margin:0">
                <div style="margin-bottom:10px;">
                    <label class="control-label" for="{{::uidl.elementName + '_' + field.propertyName}}">{{::translate(field.label, { upperCase: true })}}</label>
                </div>
                <div>
                    <uidl-form-field parent-uidl="uidl" uidl="field" entity="model.Data.entity" />
                </div>
            </div>
            <div ng-repeat-end class="hr-line-dashed"></div>
            <!-- COMMAND BUTTONS -->
            <div ng-if="uidl.commands.length && !uidl.autoSubmitOnChange" class="form-group">
                <div class="col-sm-8 col-sm-offset-4">
                    <button ng-repeat="command in uidl.commands"
                            type="button"
                            class="btn"
                            style="margin-right: 5px;"
                            ng-disabled="commandInProgress"
                            ng-class="{'btn-success':command.severity=='Read','btn-primary':command.severity=='Change','btn-warning':command.severity=='Loose','btn-danger':command.severity=='Destroy', 'btn-white':command.severity=='None'}"
                            ng-click="invokeCommand(command)"><i ng-if="command.icon" class="fa fa-{{::command.icon}}">&nbsp;</i>{{::translate(command.text)}}</button>
                </div>
            </div>
        </form>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/FormLoginStyle">
        <form class="m-t" role="form" id="{{::uidl.elementName}}" novalidate autocomplete="off">
            <div class="form-group" ng-repeat="field in plainFields">
                <uidl-form-field parent-uidl="uidl" uidl="field" entity="model.Data.entity" template-name="FormFieldLoginStyle"></uidl-form-field>
            </div>
            <div ng-repeat="command in uidl.commands" class="m-b">
                <button ng-if="command.uiStyle != 'Link'"
                        class="btn block full-width m-b"
                        ng-class="{'btn-primary':command.severity!='None', 'btn-white':command.severity=='None'}"                    
                        ng-disabled="commandInProgress"
                        ng-click="invokeCommand(command)"><i ng-if="command.icon" class="fa fa-{{::command.icon}}">&nbsp;</i>{{::translate(command.text)}}</button>
                <a ng-if="command.uiStyle == 'Link'"
                   ng-disabled="commandInProgress" 
                   ng-click="invokeCommand(command)"
                   class="commandLink"><i ng-if="command.icon" class="fa fa-{{::command.icon}}">&nbsp;</i>{{::translate(command.text)}}</a>
            </div>
        </form>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/FormSignUpStyle">
        <form class="m-t" role="form" id="{{::uidl.elementName}}" novalidate autocomplete="off">
            <div class="form-group m-b clearfix" ng-repeat="field in plainFields">
                <label class="control-label col-sm-4"
                       style="padding-top:8px;text-align:right"
                       for="{{::uidl.elementName + '_' + field.propertyName}}">{{::translate(field.label)}}</label>
                <div class="col-sm-8" style="padding:0">
                    <uidl-form-field parent-uidl="uidl" uidl="field" entity="model.Data.entity" template-name="FormFieldSignUpStyle"></uidl-form-field>
                </div>
            </div>
            <div class="form-group m-b clearfix" ng-repeat="command in uidl.commands">
                <div class="col-sm-4">&nbsp;</div>
                <div ng-if="command.uiStyle != 'Link'" class="col-sm-8" style="padding:0">
                    <button class="btn block full-width"
                            ng-class="{'btn-primary':command.severity!='None', 'btn-white':command.severity=='None'}"                    
                            ng-disabled="commandInProgress"
                            ng-click="invokeCommand(command)"><i ng-if="command.icon" class="fa fa-{{::command.icon}}">&nbsp;</i>{{::translate(command.text)}}</button>
                </div>
                <div ng-if="command.uiStyle == 'Link'" class="col-sm-8" style="padding:0;text-align:left">
                    <a ng-disabled="commandInProgress" 
                       ng-click="invokeCommand(command)"
                       class="commandLink"><i ng-if="command.icon" class="fa fa-{{::command.icon}}">&nbsp;</i>{{::translate(command.text)}}</a>
                </div>
            </div>
        </form>
    </script>
    <script type="text/javascript">
        function initWidget_Form($scope) {
            var validationRules = { };
            for (var i = 0; i < $scope.plainFields.length ; i++) {
                var field = $scope.plainFields[i];
                var fieldElementId = $scope.uidl.elementName + '_' + field.propertyName;
                var fieldRules = { 
                    required: field.validation.isRequired===true,
                    email: field.semantic==='EmailAddress',
                    //phoneUS: field.semantic==='PhoneNumber',
                    url: field.semantic==='Url' || field.semantic==='ImageUrl'
                };
                if (field.validation.minLength!==null) {
                    fieldRules.minlength = field.validation.minLength;
                }
                if (field.validation.maxLength!==null) {
                    fieldRules.maxlength = field.validation.maxLength;
                }
                validationRules[fieldElementId] = fieldRules;
                if (field.modifiers && field.modifiers.indexOf('Password') > -1 && field.modifiers.indexOf('Confirm') > -1) {
                    validationRules[fieldElementId + '__confirm'] = {
                        equalTo: '#' + fieldElementId
                    };
                }
            }
            $scope.$on(':global:FormValidating', function (event, data) {
                data.isValid = true; //start with form vaild
                var form = $('#' + $scope.uidl.elementName);
                if (form.length && !form.valid()) {
                    data.isValid = false;
                }
                else if ($scope.plainFields.length > 0) {
                    for (var i = 0; i < $scope.plainFields.length ; i++) {
                        var field = $scope.plainFields[i];

                        if (field.validation.isRequired)
                        {
                            var fieldElementId = $scope.uidl.elementName + '_' + field.propertyName;
                            var fieldElement = document.getElementById(fieldElementId);
                          
                            if (field.fieldType.toLowerCase() == "edit") {                              
                                if (fieldElement.value.length === 0) {
                                    data.isValid = false;
                                    var lbl = $("<label class='error' for='{labelValidInput}'> ").attr({ for: fieldElement.name }).text('This field is required.');
                                    $(fieldElement).addClass("error");
                                    $(fieldElement).parent().find("label").remove();
                                    $(fieldElement).parent().append(lbl);
                                }
                                else {
                                    $(fieldElement).removeClass("error");
                                    data.isValid = true;
                                }                               
                            }
                        }                       
                    }
                }

            });
            $scope.$on($scope.uidl.qualifiedName + ':StateResetter', function () {
                if ($scope.jqueryFormValidator) {
                    $scope.jqueryFormValidator.resetForm();
                    var form = $('#' + $scope.uidl.elementName);
                    form.find('.error').removeClass("error");
                }
            });
            $scope.$on($scope.uidl.qualifiedName + ':ModelSetter', function () {
                if ($scope.jqueryFormValidator) {
                    $scope.jqueryFormValidator.resetForm();
                    var form = $('#' + $scope.uidl.elementName);
                    form.find('.error').removeClass("error");
                }
            });
            $scope.$timeout(function() {
                $scope.jqueryFormValidator = $('#' + $scope.uidl.elementName).validate({
                    rules: validationRules
                });
            });
        }
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - FORM FIELD
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/FormField">
        <div ng-style="{display: parentUidl.isInlineStyle ? 'inline' : 'block'}">
            <!-- LABEL -->
            <input ng-if="uidl.fieldType==='Label' && !hasUidlModifier('Memo') && !hasUidlModifier('FlatStyle')" 
                   readonly="" 
                   class="form-control" 
                   ng-class="{'m-b': !uidl.$skin.zeroPadding}"
                   type="text" 
                   ng-model="entity[uidl.propertyName]" 
                   id="{{::uniqueFieldId}}" 
                   name="{{::uniqueFieldId}}"
                   uidl-display-format>
            <span  ng-if="uidl.fieldType==='Label' && !hasUidlModifier('Memo') && hasUidlModifier('FlatStyle')" 
                   ng-class="{'m-b': !uidl.$skin.zeroPadding}"
                   id="{{::uniqueFieldId}}" 
                   ng-show="entity[uidl.propertyName] || !uidl.hiddenIfEmpty"
                   name="{{::uniqueFieldId}}"><strong><i ng-if="uidl.icon" class="fa fa-{{::uidl.icon}}"></i>&nbsp;{{::entity[uidl.propertyName]}}</strong></span>
            <textarea ng-if="uidl.fieldType==='Label' && hasUidlModifier('Memo')"
                      readonly="" 
                      class="form-control" 
                      ng-class="{'m-b': !uidl.$skin.zeroPadding}"
                      ng-model="entity[uidl.propertyName]" 
                      id="{{::uniqueFieldId}}" 
                      name="{{::uniqueFieldId}}"
                      style="width:100%;resize:vertical;font-family: Consolas, Courier New;font-size: 10pt;"
                      ng-style="{height: (hasUidlModifier('MaxSpace') ? '50vh' : '100px')}"></textarea>
            <!-- ALERT -->
            <div ng-if="uidl.fieldType==='Alert'"
                 ng-show="entity[uidl.propertyName] || uidl.label || !uidl.hiddenIfEmpty"
                 class="alert alert-field-contents clearfix"
                 ng-class="{
                    'alert-danger': uidl.alertType==='Error', 
                    'alert-warning': uidl.alertType==='Warning',
                    'alert-info': uidl.alertType==='Info',
                    'alert-success': uidl.alertType==='Success'                   
                 }"
            >
                <i ng-if="uidl.alertType" class="fa alert-field-icon" ng-class="{
                    'fa-info':uidl.alertType==='Info',
                    'fa-check-square':uidl.alertType==='Success',
                    'fa-exclamation-triangle':uidl.alertType==='Warning',
                    'fa-times-circle':uidl.alertType==='Error'
                }"></i>
                <span>{{entity[uidl.propertyName] || translate(uidl.label)}}</span>
            </div>
            <!-- CHECKBOX -->
            <div ng-if="uidl.fieldType==='Edit' && uidl.modifiers==='Checkbox'" class="onoffswitch" ng-class="{'m-b': !uidl.$skin.zeroPadding}">
                <input type="checkbox" 
                       class="onoffswitch-checkbox" 
                       ng-model="entity[uidl.propertyName]" 
                       ng-disabled="!editAuthorized"
                       id="{{::uniqueFieldId}}"
                       name="{{::uniqueFieldId}}">
                <label class="onoffswitch-label" 
                       for="{{::uniqueFieldId}}" 
                       style="margin: 5px 0px 5px 0px;">
                    <span class="onoffswitch-inner" ng-disabled="!editAuthorized"></span>
                    <span class="onoffswitch-switch" ng-disabled="!editAuthorized"></span>
                </label>
            </div>
            <!-- TEXT -->
            <input ng-if="uidl.fieldType==='Edit' && (uidl.modifiers==='None' || !uidl.modifiers)"
                   class="form-control"
                   ng-class="{'m-b': !uidl.$skin.zeroPadding}"
                   type="text"
                   ng-model="entity[uidl.propertyName]"
                   ng-disabled="!editAuthorized"
                   id="{{::uniqueFieldId}}"
                   name="{{::uniqueFieldId}}">
            <textarea ng-if="uidl.fieldType==='Edit' && hasUidlModifier('Memo')"
                      class="form-control fieldTypeEdit" 
                      ng-readonly="hasUidlModifier('ReadOnly')"
                      ng-class="{'m-b': !uidl.$skin.zeroPadding}"
                      ng-model="entity[uidl.propertyName]" 
                      id="{{::uniqueFieldId}}" 
                      name="{{::uniqueFieldId}}"
                      style="width:100%;resize:vertical;font-family: Consolas, Courier New;font-size: 10pt;"
                      ng-style="{height: (hasUidlModifier('MaxSpace') ? '50vh' : '100px')}"></textarea>
            <!-- PASSWORD -->
            <div ng-if="uidl.fieldType==='Edit' && hasUidlModifier('Password')" ng-class="{'m-b': !uidl.$skin.zeroPadding}">
                <div>
                    <input class="form-control"
                           type="password"
                           ng-model="entity[uidl.propertyName]"
                           ng-disabled="!editAuthorized"
                           id="{{::uniqueFieldId}}"
                           name="{{::uniqueFieldId}}">
                </div>
                <div ng-if="uidl.fieldType==='Edit' && hasUidlModifier('Password') && hasUidlModifier('Confirm')">
                    <label style="margin:3px 0 3px 0;font-weight:normal;">Confirm:</label>
                </div>
                <div>
                    <input ng-if="uidl.fieldType==='Edit' && hasUidlModifier('Password') && hasUidlModifier('Confirm')"
                           class="form-control"
                           type="password"
                           ng-model="hiddenValues[uidl.propertyName]"
                           ng-disabled="!editAuthorized"
                           id="{{::uniqueFieldId + '__confirm'}}"
                           name="{{::uniqueFieldId + '__confirm'}}">
                 </div>
            </div>
            <!-- DATE-TIME PICKER -->
            <div ng-if="uidl.fieldType==='Edit' && uidl.modifiers==='DateTimePicker'"
                 class="input-group date"
                 ng-class="{'m-b': !uidl.$skin.zeroPadding}"
                 ng-disabled="!editAuthorized"
                 ng-init="if (!parsedEntity) parsedEntity = { };">
                <input type="text"
                       class="form-control"
                       ng-model="parsedEntity[uidl.propertyName]"
                       ng-disabled="!editAuthorized"
                       id="{{::uniqueFieldId}}"
                       name="{{::uniqueFieldId}}">
                <div class="input-group-addon">
                    <span class="glyphicon glyphicon-th"></span>
                </div>
            </div>
            <!-- DATE-TIME RANGE PICKER -->
            <div ng-if="uidl.fieldType==='Edit' && hasUidlModifier('DateTimePicker') && hasUidlModifier('RangeStart')"
                 class="form-control"
                 ng-class="{'m-b': !uidl.$skin.zeroPadding}"
                 id="{{::uniqueFieldId}}"
                 name="{{::uniqueFieldId}}"
                 ng-disabled="!editAuthorized">
                <i class="fa fa-calendar"></i>
                <span></span> <b class="caret"></b>
            </div>
            <!-- LOOKUP ELLIPSIS -->
            <div ng-if="uidl.fieldType==='Lookup' && hasUidlModifier('Ellipsis')"
                 class="input-group"
                 ng-class="{'m-b': !uidl.$skin.zeroPadding}"
                 ng-disabled="!editAuthorized">
                 <span ng-show ="entity && entity[uidl.propertyName]" class="input-group-addon">{{entity[uidl.propertyName]}}</span>
                 <input type="text" 
                        class="form-control"
                        ng-init="isNowFocused=false" 
                        ng-focus="isNowFocused=!hasUidlModifier('ReadOnly')" 
                        ng-blur="isNowFocused=false"                        
                        ng-model="displayName"
                        readonly
                        id="{{::uniqueFieldId}}"
                        name="{{::uniqueFieldId}}"> 
                 <span class="input-group-btn"> 
                     <button type="button" 
                             class="btn" 
                             ng-disabled="hasUidlModifier('ReadOnly') || !editAuthorized"
                             ng-class="{'btn-primary':isNowFocused, 'btn-white':!isNowFocused}"
                             ng-click="ellipsisClicked()">
                        <i class="fa fa-search"></i>
                     </button>
                 </span>
            </div>            
            <!-- DROP DOWN -->
            <select ng-if="uidl.fieldType==='Lookup' && hasUidlModifier('DropDown') && hasUidlModifier('LookupShowSelectAll')"
                    class="form-control"
                    ng-class="{'m-b': !uidl.$skin.zeroPadding}"
                    ng-options="item[lookupValueProperty] as item[lookupTextProperty] for item in lookupResultSet"
                    ng-model="entity[lookupForeignKeyProperty]"
                    ng-disabled="!editAuthorized"
                    id="{{::uniqueFieldId}}"
                    name="{{::uniqueFieldId}}">
                <option value="">All</option>
            </select>
            <select ng-if="uidl.fieldType==='Lookup' && hasUidlModifier('DropDown') && hasUidlModifier('LookupShowSelectNone')"
                    class="form-control"
                    ng-class="{'m-b': !uidl.$skin.zeroPadding}"
                    ng-options="item[lookupValueProperty] as item[lookupTextProperty] for item in lookupResultSet"
                    ng-model="entity[lookupForeignKeyProperty]"
                    ng-disabled="!editAuthorized"
                    id="{{::uniqueFieldId}}"
                    name="{{::uniqueFieldId}}">
                <option value="">- Choose -</option>
            </select>
            <select ng-if="uidl.fieldType==='Lookup' && hasUidlModifier('DropDown') && !hasUidlModifier('LookupShowSelectAll') && !hasUidlModifier('LookupShowSelectNone')"
                    class="form-control"
                    ng-class="{'m-b': !uidl.$skin.zeroPadding}"
                    ng-options="item[lookupValueProperty] as item[lookupTextProperty] for item in lookupResultSet"
                    ng-model="entity[lookupForeignKeyProperty]"
                    ng-disabled="!editAuthorized"
                    id="{{::uniqueFieldId}}"
                    name="{{::uniqueFieldId}}">
            </select>
            <!-- TYPEAHEAD -->
            <input ng-if="uidl.fieldType==='Lookup' && hasUidlModifier('TypeAhead')"
                type="text" 
                ng-model="entity[lookupForeignKeyProperty]" 
                ng-disabled="!editAuthorized"
                placeholder="None Selected" 
                typeahead="item as item for item in loadTypeAhead($viewValue)" 
                typeahead-input-formatter="formatTypeAheadItem($model)"
                typeahead-loading="isLoadingTypeAhead" 
                typeahead-no-results="isTypeAheadResultSetEmpty" 
                typeahead-on-select="entity[lookupForeignKeyProperty]=$item['$id']"
                class="form-control"
                ng-class="{'m-b': !uidl.$skin.zeroPadding}"
                id="{{::uniqueFieldId}}"
                name="{{::uniqueFieldId}}">
            <!-- FILE UPLOAD -->
            <div ng-if="uidl.fieldType==='FileUpload'" 
                 id="{{::uniqueFieldId}}"
                 class="dropzone" 
                 style="border-radius:2px;border: 2px lightgray dotted;background-color:white;">
                 <div class="dropzone-previews" ng-disabled="!editAuthorized"></div>
            </div>
            <div ng-if="uidl.fieldType==='FileUpload'" ng-class="{'m-b': !uidl.$skin.zeroPadding}">
                <a href="" ng-click="clearDropzone()" ng-disabled="!editAuthorized">Clear</a>
            </div>
            <!-- IMAGE + UPLOAD -->
            <div ng-if="uidl.fieldType==='ImageUpload'" 
                 id="{{::uniqueFieldId}}"
                 class="dropzone" 
                 style="border-radius:2px;border: 2px lightgray dotted;background-color:white;">
                 <div class="dropzone-previews" ng-disabled="!editAuthorized"></div>
            </div>
            <div ng-if="uidl.fieldType==='ImageUpload'" ng-class="{'m-b': !uidl.$skin.zeroPadding}">
                <a href="" ng-click="clearDropzone()" ng-disabled="!editAuthorized">Clear</a>
            </div>
        </div>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/FormFieldLoginStyle">
        <div>
            <!-- LABEL -->
            <h3 ng-if="uidl.fieldType==='Label'" ng-bind="entity[uidl.propertyName]"></h3>
            <!-- TEXT -->
            <input ng-if="uidl.fieldType==='Edit' && (uidl.modifiers==='None' || !uidl.modifiers)"
                   class="form-control"
                   type="text"
                   placeholder="{{::translate(uidl.label)}}"
                   ng-model="$parent.entity[uidl.propertyName]"
                   id="{{::uniqueFieldId}}"
                   name="{{::uniqueFieldId}}"
                   apply-auto-fill-fix>
            <!-- PASSWORD -->
            <input ng-if="uidl.fieldType==='Edit' && hasUidlModifier('Password')"
                   class="form-control"
                   type="password"
                   placeholder="{{::translate(uidl.label)}}"
                   ng-model="$parent.entity[uidl.propertyName]"
                   id="{{::uniqueFieldId}}"
                   name="{{::uniqueFieldId}}"
                   apply-auto-fill-fix>
            <input ng-if="uidl.fieldType==='Edit' && hasUidlModifier('Password') && hasUidlModifier('Confirm')"
                   class="form-control"
                   style="margin-top:15px;"
                   type="password"
                   placeholder="Confirm password"
                   ng-model="$parent.hiddenValues[uidl.propertyName]"
                   id="{{::uniqueFieldId + '__confirm'}}"
                   name="{{::uniqueFieldId + '__confirm'}}"
                   apply-auto-fill-fix>
            <!-- DROP DOWN -->
            <select ng-if="uidl.fieldType==='Lookup' && hasUidlModifier('DropDown')"
                    class="form-control m-b"
                    ng-options="item[lookupValueProperty] as item[lookupTextProperty] for item in lookupResultSet"
                    ng-model="entity[lookupForeignKeyProperty]"
                    id="{{::uniqueFieldId}}"
                    name="{{::uniqueFieldId}}">
                <option value="">- {{::translate(uidl.label)}} -</option>
            </select>
            <!-- TYPEAHEAD -->
            <input ng-if="uidl.fieldType==='Lookup' && hasUidlModifier('TypeAhead')"
                type="text" 
                ng-model="entity[lookupForeignKeyProperty]" 
                placeholder="None Selected" 
                typeahead="item in loadTypeAhead($viewValue)" 
                typeahead-input-formatter="formatTypeAheadItem($model)"
                typeahead-loading="isLoadingTypeAhead" 
                typeahead-no-results="isTypeAheadResultSetEmpty" 
                typeahead-on-select="entity[lookupForeignKeyProperty]=$item['$id']"
                class="form-control m-b"
                id="{{::uniqueFieldId}}"
                name="{{::uniqueFieldId}}">
        </div>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/FormFieldSignUpStyle">
        <div>
            <!-- LABEL -->
            <h3 ng-if="uidl.fieldType==='Label' && uidl.label" ng-bind="entity[uidl.propertyName]"></h3>
            <h2 ng-if="uidl.fieldType==='Label' && !uidl.label" ng-bind="entity[uidl.propertyName]" style="text-align:left;"></h2>
            <!-- TEXT -->
            <input ng-if="uidl.fieldType==='Edit' && (uidl.modifiers==='None' || !uidl.modifiers)"
                   class="form-control"
                   type="text"
                   placeholder="{{::translate(uidl.label)}}"
                   ng-model="$parent.entity[uidl.propertyName]"
                   id="{{::uniqueFieldId}}"
                   name="{{::uniqueFieldId}}"
                   apply-auto-fill-fix>
            <!-- PASSWORD -->
            <input ng-if="uidl.fieldType==='Edit' && hasUidlModifier('Password')"
                   class="form-control"
                   type="password"
                   placeholder="{{::translate(uidl.label)}}"
                   ng-model="$parent.entity[uidl.propertyName]"
                   id="{{::uniqueFieldId}}"
                   name="{{::uniqueFieldId}}"
                   apply-auto-fill-fix>
            <input ng-if="uidl.fieldType==='Edit' && hasUidlModifier('Password') && hasUidlModifier('Confirm')"
                   class="form-control"
                   style="margin-top:15px;"
                   type="password"
                   placeholder="Confirm password"
                   ng-model="$parent.hiddenValues[uidl.propertyName]"
                   id="{{::uniqueFieldId + '__confirm'}}"
                   name="{{::uniqueFieldId + '__confirm'}}"
                   apply-auto-fill-fix>
            <!-- DROP DOWN -->
            <select ng-if="uidl.fieldType==='Lookup' && hasUidlModifier('DropDown')"
                    class="form-control m-b"
                    ng-options="item[lookupValueProperty] as item[lookupTextProperty] for item in lookupResultSet"
                    ng-model="entity[lookupForeignKeyProperty]"
                    id="{{::uniqueFieldId}}"
                    name="{{::uniqueFieldId}}">
                <option value="">- {{::translate(uidl.label)}} -</option>
            </select>
            <!-- TYPEAHEAD -->
            <input ng-if="uidl.fieldType==='Lookup' && hasUidlModifier('TypeAhead')"
                type="text" 
                ng-model="entity[lookupForeignKeyProperty]" 
                placeholder="None Selected" 
                typeahead="item in loadTypeAhead($viewValue)" 
                typeahead-input-formatter="formatTypeAheadItem($model)"
                typeahead-loading="isLoadingTypeAhead" 
                typeahead-no-results="isTypeAheadResultSetEmpty" 
                typeahead-on-select="entity[lookupForeignKeyProperty]=$item['$id']"
                class="form-control m-b"
                id="{{::uniqueFieldId}}"
                name="{{::uniqueFieldId}}">
        </div>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/FormFieldAlertStyle">
        <div>
            <!-- ALERT -->
            <div ng-if="uidl.fieldType==='Alert'"
                 class="row"
                 style="margin:0;padding:30px;"
                 ng-class="{
                    'alert-danger': uidl.alertType==='Error', 
                    'alert-warning': uidl.alertType==='Warning',
                    'alert-info': uidl.alertType==='Info',
                    'alert-success': uidl.alertType==='Success'                   
                 }"
            >
                <div class="col-xs-1" style="text-align:right">
                    <h2><i ng-if="uidl.alertType" class="fa" ng-class="{
                        'fa-info':uidl.alertType==='Info',
                        'fa-check-square':uidl.alertType==='Success',
                        'fa-exclamation-triangle':uidl.alertType==='Warning',
                        'fa-times-circle':uidl.alertType==='Error'
                    }"></i></h2>
                </div>
                <div class="col-xs-11">
                    <span>{{entity[uidl.propertyName] || translate(uidl.label)}}</span>
                </div>
            </div>
        </div>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/FormFieldAlertStyleBig">
        <div class="m-b">
            <!-- ALERT -->
            <div ng-if="uidl.fieldType==='Alert'"
                 style="margin:0;padding:15px 10px 10px 0;max-width:300px;"
                 class="m-b container"
                 ng-class="{
                    'alert-danger': uidl.alertType==='Error', 
                    'alert-warning': uidl.alertType==='Warning',
                    'alert-info': uidl.alertType==='Info',
                    'alert-success': uidl.alertType==='Success'                   
                 }"
            >
                <div class="row" style="margin:0;padding:0">
                    <div class="col-md-2" style="margin:0;">
                        <h3 style="font-weight:normal;"><i ng-if="uidl.alertType" class="fa fa-lg" ng-class="{
                            'fa-info':uidl.alertType==='Info',
                            'fa-check-square':uidl.alertType==='Success',
                            'fa-exclamation-triangle':uidl.alertType==='Warning',
                            'fa-times-circle':uidl.alertType==='Error'
                        }"></i></h3>
                    </div>
                    <div class="col-md-10" style="text-align:left;padding:0;margin:0;">
                        <h3 style="font-weight:normal;">{{entity[uidl.propertyName] || translate(uidl.label)}}</h3>
                    </div>
                </div>
            </div>
        </div>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/FormFieldGridInlineEditStyle">
        <div>
            <!-- CHECKBOX -->
            <input ng-if="uidl.fieldType==='Edit' && uidl.modifiers==='Checkbox'"
                   type="checkbox" 
                   ng-model="entity[uidl.propertyName]" 
                   id="{{::uniqueFieldId}}"
                   name="{{::uniqueFieldId}}"
                   class="grid-inline-edit-control"
                   ng-true-value="true"
                   ng-false-value="false">
            <!-- TEXT -->
            <input ng-if="uidl.fieldType==='Edit' && (uidl.modifiers==='None' || !uidl.modifiers)"
                   type="text"
                   ng-model="entity[uidl.propertyName]"
                   id="{{::uniqueFieldId}}"
                   name="{{::uniqueFieldId}}"
                   class="grid-inline-edit-control">
            <!-- LOOKUP -->
            <select ng-if="uidl.fieldType==='Lookup' && hasUidlModifier('DropDown') && hasUidlModifier('LookupShowSelectAll')"
                    class="grid-inline-edit-control"
                    ng-options="item[lookupValueProperty] as item[lookupTextProperty] for item in lookupResultSet"
                    ng-model="entity[lookupForeignKeyProperty]"
                    id="{{::uniqueFieldId}}"
                    name="{{::uniqueFieldId}}">
                <option value="">All</option>
            </select>
            <select ng-if="uidl.fieldType==='Lookup' && hasUidlModifier('DropDown') && hasUidlModifier('LookupShowSelectNone')"
                    class="grid-inline-edit-control"
                    ng-options="item[lookupValueProperty] as item[lookupTextProperty] for item in lookupResultSet"
                    ng-model="entity[lookupForeignKeyProperty]"
                    id="{{::uniqueFieldId}}"
                    name="{{::uniqueFieldId}}">
                <option value="">- Choose -</option>
            </select>
            <select ng-if="uidl.fieldType==='Lookup' && hasUidlModifier('DropDown') && !hasUidlModifier('LookupShowSelectAll') && !hasUidlModifier('LookupShowSelectNone')"
                    class="grid-inline-edit-control"
                    ng-options="item[lookupValueProperty] as item[lookupTextProperty] for item in lookupResultSet"
                    ng-model="entity[lookupForeignKeyProperty]"
                    id="{{::uniqueFieldId}}"
                    name="{{::uniqueFieldId}}">
            </select>
            <!-- LOOKUP MANY -->
            <div ng-if="uidl.fieldType==='LookupMany' && hasUidlModifier('DropDown') && hasUidlModifier('DualList')"
                    class="grid-inline-edit-control"
                    id="{{::uniqueFieldId}}"
                    name="{{::uniqueFieldId}}">
                    <div class="global-dropdown-toggle"><i class="fa fa-lg fa-caret-down"></i><span ng-if="entity[uidl.propertyName]">{{entity[uidl.propertyName].length || '0'}} items</span>
                </div>
                <div class="global-dropdown-content" style="display:none;margin: 0 auto;width: 35%;margin: 0 auto;">
                    <div class="grid-inline-edit-dropdown-panel">
                        <uidl-widget uidl="uidl.nestedWidget" parent-uidl="uidl" parent-model="entity"></uidl-widget>
                    </div>
                </div>
            </div>
            <!-- DATE-TIME PICKER -->
            <div ng-if="uidl.fieldType==='Edit' && uidl.modifiers==='DateTimePicker'"
                 class="input-group date"
                 ng-class="{'m-b': !uidl.$skin.zeroPadding}"
                 ng-disabled="!editAuthorized">
                <input type="text"
                       class="form-control"
                       ng-model="entity[uidl.propertyName]"
                       ng-disabled="!editAuthorized"
                       id="{{::uniqueFieldId}}"
                       name="{{::uniqueFieldId}}">
                <div class="input-group-addon">
                    <span class="glyphicon glyphicon-th"></span>
                </div>
            </div>
            <!-- DATE-TIME RANGE PICKER -->
            <div ng-if="uidl.fieldType==='Edit' && hasUidlModifier('DateTimePicker') && hasUidlModifier('RangeStart')"
                 class="form-control"
                 ng-class="{'m-b': !uidl.$skin.zeroPadding}"
                 id="{{::uniqueFieldId}}"
                 name="{{::uniqueFieldId}}"
                 ng-disabled="!editAuthorized">
                <i class="fa fa-calendar"></i>
                <span></span> <b class="caret"></b>
            </div>
            <!-- LOOKUP ELLIPSIS -->
            <div ng-if="uidl.fieldType==='Lookup' && hasUidlModifier('Ellipsis')"
                 class="input-group"
                 ng-class="{'m-b': !uidl.$skin.zeroPadding}"
                 ng-disabled="!editAuthorized">
                 <span ng-show ="entity && entity[uidl.propertyName]" class="input-group-addon">{{entity[uidl.propertyName]}}</span>
                 <input type="text" 
                        class="form-control"
                        ng-init="isNowFocused=false" 
                        ng-focus="isNowFocused=!hasUidlModifier('ReadOnly')" 
                        ng-blur="isNowFocused=false"                        
                        ng-model="displayName"
                        readonly
                        id="{{::uniqueFieldId}}"
                        name="{{::uniqueFieldId}}"> 
                 <span class="input-group-btn"> 
                     <button type="button" 
                             class="btn" 
                             ng-disabled="hasUidlModifier('ReadOnly') || !editAuthorized"
                             ng-class="{'btn-primary':isNowFocused, 'btn-white':!isNowFocused}"
                             ng-click="ellipsisClicked()">
                        <i class="fa fa-search"></i>
                     </button>
                 </span>
            </div>            
            <!-- TYPEAHEAD -->
            <input ng-if="uidl.fieldType==='Lookup' && hasUidlModifier('TypeAhead')"
                type="text" 
                ng-model="entity[lookupForeignKeyProperty]" 
                ng-disabled="!editAuthorized"
                placeholder="None Selected" 
                typeahead="item as item for item in loadTypeAhead($viewValue)" 
                typeahead-input-formatter="formatTypeAheadItem($model)"
                typeahead-loading="isLoadingTypeAhead" 
                typeahead-no-results="isTypeAheadResultSetEmpty" 
                typeahead-on-select="entity[lookupForeignKeyProperty]=$item['$id']"
                class="form-control"
                ng-class="{'m-b': !uidl.$skin.zeroPadding}"
                id="{{::uniqueFieldId}}"
                name="{{::uniqueFieldId}}">
            <!-- FILE UPLOAD -->
            <div ng-if="uidl.fieldType==='FileUpload'" 
                 id="{{::uniqueFieldId}}"
                 class="dropzone" 
                 style="border-radius:2px;border: 2px lightgray dotted;background-color:white;">
                 <div class="dropzone-previews" ng-disabled="!editAuthorized"></div>
            </div>
            <div ng-if="uidl.fieldType==='FileUpload'" ng-class="{'m-b': !uidl.$skin.zeroPadding}">
                <a href="" ng-click="clearDropzone()" ng-disabled="!editAuthorized">Clear</a>
            </div>
            <!-- IMAGE + UPLOAD -->
            <div class="row" ng-if="uidl.fieldType==='ImageUpload'">
                <div ng-if="uidl.fieldType==='ImageUpload'" class="col-sm-3">
                    <img ng-show="entity[uidl.propertyName]" ng-src="{{entity[uidl.propertyName]}}" err-src="app/skin/assets/img/avatar_missing.jpg" class="img-circle circle-border m-b-md" width="128" height="128" alt="profile photo">
                    <img ng-hide="entity[uidl.propertyName]" ng-src="app/skin/assets/img/avatar_missing.jpg" class="img-circle circle-border m-b-md" width="128" height="128" alt="profile photo missing">
                </div>
                <div ng-if="uidl.fieldType==='ImageUpload'" 
                     class="col-sm-5 dropzone m-l" 
                     id="{{::uniqueFieldId}}"
                     style="border-radius:2px;border: 2px lightgray dotted;background-color:white;">
                     <div class="dropzone-previews" ng-disabled="!editAuthorized"></div>
                </div>
            </div>
        </div>
    </script>
    
    
    <script type="text/javascript">

        /*
        '<div class="editable">' +
        '<div class="global-dropdown-toggle">' +
        '<i class="fa fa-lg fa-caret-down"></i>' +
        '<span class="dropdown-cell-text">3 item(s)</span>' + 
        '</div>' +
        '<div class="global-dropdown-content">' +
        '<uidl-widget uidl="uidl" parent-uidl="parentUidl" parent-model="data"></uidl-widget>' +
        '</div>' +
        '</div>'
        */
    
        function initWidget_FormField($scope) {
            var dateTimePickerValueChanged = function(e) {
                if (e.date===false) {
                    $scope.entity[$scope.uidl.propertyName] = null;
                } else {
                    $scope.entity[$scope.uidl.propertyName] = e.date.format('YYYY-MM-DD HH:mm:ss');
                }
            };
            if ($scope.uidl.modifiers === 'DateTimePicker') {
                $scope.createDateTimePicker = function() {
                    if ($scope.dateTimePickerCreated) {
                        return;
                    }
                    var uidlFormat = ($scope.uidl.format || null);
                    var pickerFormat = null;
                    if (uidlFormat == null || uidlFormat.indexOf('Second') > -1) {
                        pickerFormat = 'YYYY-MM-DD HH:mm:ss';
                    } else if (uidlFormat.indexOf('Minute') > -1) {
                        pickerFormat = 'YYYY-MM-DD HH:mm';
                    } else {
                        pickerFormat = 'YYYY-MM-DD';
                    }
                    $('#' + $scope.uniqueFieldId).datetimepicker({
                        format: pickerFormat,
                        allowInputToggle: true
                    }).on('dp.change', dateTimePickerValueChanged);
                };
                $scope.updateViewFromModel = function() {
                    var value = moment($scope.entity[$scope.uidl.propertyName]);
                    var dateTimePicker = $('#' + $scope.uniqueFieldId).data("DateTimePicker");
                    dateTimePicker.date(value);
                };
                $scope.$watch('entity', function(newValue, oldValue) {
                    if ($scope.entity) {
                        $scope.createDateTimePicker();
                        $scope.updateViewFromModel();
                        $scope.$watch('entity.' + $scope.uidl.propertyName, function() {
                            $scope.updateViewFromModel();
                        });
                    }
                });
            }
            if ($scope.hasUidlModifier('DateTimePicker') && $scope.hasUidlModifier('RangeStart')) {
                $scope.timeRangePresets = null;
                $scope.dateTimeRangePickerCreated = false;
                $scope.displayFormatString = 'YYYY-MM-DD';
                $scope.createDefaultLocale = function() {
                    return {
                        "format": "YYYY-MM-DD",
                        "separator": " - ",
                        "applyLabel": "Apply",
                        "cancelLabel": "Cancel",
                        "fromLabel": "From",
                        "toLabel": "To",
                        "customRangeLabel": "Custom",
                        "daysOfWeek": [ "Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"    ],
                        "monthNames": [ "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December" ],
                        "firstDay": 0
                    }
                };
                $scope.$http.get('app/timeRangePresets').then(function (response) {
                    var presetDictionary = { };
                    for (var i = 0; i < response.data.length ; i++) {
                        var preset = response.data[i];
                        if ($.inArray(preset.name, $scope.uidl.standardValues) >= 0) {
                            presetDictionary[$scope.translate(preset.name)] = [moment(preset.start, 'YYYY-MM-DD HH:mm:ss'), moment(preset.end, 'YYYY-MM-DD HH:mm:ss')];
                            if (preset.name.indexOf('Hour') > -1 || preset.name.indexOf('Minute') > -1) {
                                $scope.shouldHaveTimePart = true;
                                $scope.displayFormatString = 'YYYY-MM-DD HH:mm:ss';
                            }
                        }
                    }
                    $scope.timeRangePresets = presetDictionary;
                });
                $scope.displayDateRange = function(start, end) {
                    var label = $scope.tryFindRangePreset(start, end);
                    if (label) {
                        $('#' + $scope.uniqueFieldId + ' span').html(label);
                    } else {
                        $('#' + $scope.uniqueFieldId + ' span').html(start.format($scope.displayFormatString) + ' - ' + end.format($scope.displayFormatString));
                    }
                };
                $scope.tryFindRangePreset = function(start, end) {
                    var precision = ($scope.shouldHaveTimePart ? 'second' : 'day');
                    for (var label in $scope.timeRangePresets){
                        if ($scope.timeRangePresets.hasOwnProperty(label) && label.length > 0){
                            var range = $scope.timeRangePresets[label];
                            if (range[0].isSame(start, precision) && range[1].isSame(end, precision)) {
                                return label;
                            }
                        }
                    }
                    return null;
                };
                $scope.updateViewFromModel = function() {
                    var startValue = moment($scope.entity[$scope.uidl.propertyName]);
                    var endValue = moment($scope.entity[$scope.groupFields[0].propertyName]);
                    $scope.displayDateRange(startValue, endValue);
                    var picker = $('#' + $scope.uniqueFieldId).data('daterangepicker');
                    if (picker) {
                        picker.setStartDate(startValue);
                        picker.setEndDate(endValue);
                    }
                };
                $scope.createDateTimeRangePicker = function() {
                    if ($scope.dateTimeRangePickerCreated || !$scope.entity || !$scope.entity[$scope.uidl.propertyName] || !$scope.timeRangePresets) {
                        return;
                    }
                    var rangePickerOptions = {
                        startDate: moment($scope.entity[$scope.uidl.propertyName], 'YYYY-MM-DD HH:mm:ss'),
                        endDate: moment($scope.entity[$scope.groupFields[0].propertyName], 'YYYY-MM-DD HH:mm:ss'),
                        ranges: $scope.timeRangePresets,
                        linkedCalendars: false,
                        showDropdowns: true,
                        locale: $scope.createDefaultLocale()
                    };
                    if ($scope.shouldHaveTimePart) {
                        rangePickerOptions.timePicker = true;
                        rangePickerOptions.timePickerSeconds = true;
                        rangePickerOptions.timePicker24Hour = true;
                        rangePickerOptions.timePickerIncrement = 1;
                        rangePickerOptions.locale.format = 'YYYY-MM-DD HH:mm:ss';
                    };
                    $('#' + $scope.uniqueFieldId).daterangepicker(rangePickerOptions, function(start, end, label) {
                        $scope.displayDateRange(start, end);
                        $scope.entity[$scope.uidl.propertyName] = start.format('YYYY-MM-DD HH:mm:ss');
                        $scope.entity[$scope.groupFields[0].propertyName] = end.format('YYYY-MM-DD HH:mm:ss');
                    });
                    $('#' + $scope.uniqueFieldId).on('apply.daterangepicker', function(ev, picker) {
                        $scope.$apply();
                    });
                    $scope.dateTimeRangePickerCreated = true;
                };
                $scope.$watch('entity', function(newValue, oldValue) {
                    if ($scope.entity) {
                        $scope.displayDateRange(moment($scope.entity[$scope.uidl.propertyName]), moment($scope.entity[$scope.groupFields[0].propertyName]));
                        $scope.createDateTimeRangePicker();
                        $scope.$watch('entity.' + $scope.uidl.propertyName, function() {
                            $scope.updateViewFromModel();
                        });
                        $scope.$watch('entity.' + $scope.groupFields[0].propertyName, function() {
                            $scope.updateViewFromModel();
                        });
                    }
                });
                $scope.$watch('timeRangePresets', function(newValue, oldValue) {
                    $scope.createDateTimeRangePicker();
                });
            }
            if ($scope.uidl.fieldType==='FileUpload' || $scope.uidl.fieldType==='ImageUpload') {
                $scope.dropzone = new Dropzone('#' + $scope.uniqueFieldId, {
                    url: 'app/uploadContent',
                    maxFiles: 1,
                    maxFilesize: 5,
                    //acceptedFiles: '*.xslx',
                    autoProcessQueue: true,
                    clickable: true,
                    addRemoveLinks: true,
                    dictDefaultMessage: 'Drop a file here, or click to choose',
                    dictResponseError: 'Upload failed',
                    init: function() {
                        this.on('error', function(file, response) {
                            //var errorMessage = response.errorMessage;
                            $(file.previewElement).find('.dz-error-message').text('Upload failed.');
                        });
                    },
                    accept: function(file, done) {
                        done();
                        //if (file.type==='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet') {
                        //    done();
                        //} else {
                        //    done('Invalid file type.');
                        //}
                    },
                });
                $scope.clearDropzone = function() {
                    $scope.dropzone.removeAllFiles(true);
                };
                $scope.$watch('entity[uidl.propertyName]', function(newValue, oldValue) {
                    $scope.clearDropzone();
                });
            }
        }
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - TASK PAD / TASK PAD ITEM
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/TaskPad">
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox">
                    <div class="ibox-title">
                        <h5>{{::translate(uidl.text)}}</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="list-group">
                            <uidl-widget ng-repeat="item in uidl.items" uidl="item"></uidl-widget>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/TaskPadItem">
        <a class="list-group-item">
            <h3 class="list-group-item-heading">{{::translate(uidl.text)}}</h3>
            <p class="list-group-item-text">{{::translate(uidl.description)}}</p>
            <button 
                ng-repeat="command in uidl.commands"
                type="button"
                class="btn"
                ng-click="performTask(command);"
                ng-class="{
                    'btn-success':command.severity=='Read',
                    'btn-primary':command.severity=='Change',
                    'btn-warning':command.severity=='Loose',
                    'btn-danger':command.severity=='Destroy'
                }"
            ><i ng-if="command.icon" class="fa fa-{{::command.icon}}">&nbsp;</i>{{::translate(command.text)}}</button>
        </a>
    </script>
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - CHAT
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/Chat">
        <div>Message 1 . . . </div>
        <div>Message 2 . . . </div>
        <div>Message 3 . . . </div>
        <textarea></textarea>
        <button>Send</button>
    </script>
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - CHART
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/Chart">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h2>
                    {{::translate(uidl.text)}}
                </h2>
                <div class="ibox-tools">
                    <div class="btn-group" ng-repeat="command in uidl.commands" ng-if="command.nodeType==='CommandGroup'">
                        <button 
                            ng-repeat="item in command.items" 
                            ng-click="invokeCommand(command, item)" 
                            ng-class="{'btn-primary':item.isChecked===true, 'btn-white':item.isChecked!==true}"
                            class="btn" 
                            type="button">{{::translate(item.text)}}</button>
                    </div>                
                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>
                </div>                
            </div>
            <div class="ibox-content ui-widget-content" id="{{::uidl.elementName}}_container">
                <div id="{{::uidl.elementName}}" 
                     class="flot-chart-content" 
                     style="padding:0px; position:relative;"
                     ng-style="{ height: calculateHeight(100) }"></div>
                <!--div class="m-t-md">
            <small class="pull-right">
                <i class="fa fa-clock-o"> </i>
                Update on 16.07.2015
            </small>
            <small>
                <strong>Analysis of sales:</strong> The value has been changed over time, and last month reached a level over $50,000.
            </small>
        </div-->
            </div>
        </div>
    </script>
    <script type="text/ng-template" id="app/uidl-element-template/ChartInline">
        <div id="{{::uidl.elementName}}" 
             class="flot-chart-content" 
             style="padding:0px; position:relative;"
             ng-style="{ height: calculateHeight(80) }"></div>
    </script>
    <script type="text/javascript">
        function initWidget_Chart($scope) {
            //                    Green        Blue       Red        brown     yellow    Pink       Dark Green  Purpel    Very dark   light blue
            var seriesPalette = ["#00ff00", "#6666ff", "#ff0000", "#ff9900", "#e6e600", "#ff66ff", "#00b3150", "#9966ff", "#336600", "#66ffff"];
            
            switch ($scope.uidl.palette) {
                case 'LogLevelSeries': 
                    seriesPalette = ["#990000", "#ff0000", "#ff9900", "#009933", "#666699", "#c2c2d6"];
                    break;
                case 'PassFailSeries': 
                    seriesPalette = ["#009933", "#ff0000"];
                    break;
            }
           
            if ($scope.parentModel) {
                $scope.model.State.data = $scope.parentModel;
            }

            $scope.$timeout(function() {
                if ($scope.model.State.data) {
                    buildChart('#' + $scope.uidl.elementName, $scope.model.State.data);
                    //$('#' + $scope.uidl.elementName).plot(buildChartSeries(/*demoServerData*/$scope.model.State.data), options);
                }
                else {
                    $scope.$watch('model.State.data', function(newValue, oldValue) {
                        if (newValue) {
                            buildChart('#' + $scope.uidl.elementName, newValue);
                            //$('#' + $scope.uidl.elementName).plot(buildChartSeries(/*demoServerData*/$scope.model.State.data), options);
                        }
                    });
                }
            });

            function buildChart(elementId, serverData) {
                $(elementId).unbind();
                $(elementId).empty();

                if(serverData.Series[0].Mode==='Time') {
                    buildTimeChart(elementId, serverData);
                } else {
                    buildCategoryChart(elementId, serverData);
                }
            }
            
            function buildCategoryChart(elementId, serverData) {
                for (var li = 0 ; li < serverData.Labels.length ; li++) {
                    serverData.Labels[li] = (serverData.Labels[li] || '').replace(/(?:\r\n|\r|\n)/g, '<br />');
                }
                
                var options = buildCategoryOptions(serverData);
                var series = buildCategorySeries(serverData);
                
                $(elementId).plot(series, options);
            }
            function buildCategorySeries(serverData) {
                var chartSeries = [];
                
                for (var si = 0; si < serverData.Series.length; si++) {
                    var series = {
                        label: (serverData.Series[si].Label || '').replace(/(?:\r\n|\r|\n)/g, '<br />'),
                        data: []
                    };
                    for (var xi = 0; xi < serverData.Series[si].Values.length; xi++) {
                        series.data.push([xi, serverData.Series[si].Values[xi]]);
                    }
                    chartSeries.push(series);
                }
                
                return chartSeries;
            }
            function buildCategoryOptions(serverData) {
                var options = {
                    series: {
                        lines: {
                            show: true,
                            lineWidth: 2,
                            fill: true,
                            fillColor: {
                                colors: [{
                                    opacity: 0.1
                                }, {
                                    opacity: 0.1
                                }]
                            }
                        },
                        shadowSize: 0,
                    },
                    xaxis: {
                        mode: "categories",
                        tickDecimals: 0,
                        ticks: [], 
                    },
                    yaxis: {
                        min: 0,
                        tickDecimals: 0,
                    },
                    colors: ["#1ab394"],
                    grid: {
                        color: "#999999",
                        hoverable: true,
                        clickable: true,
                        tickColor: "#D4D4D4",
                        borderWidth:0
                    },
                    legend: {
                        show: true
                    },
                    tooltip: true,
                    tooltipOpts: {
                        content: function(label, xval, yval, flotItem) {
                            var tickLabel = flotItem.series.xaxis.ticks[xval].label.replace(/<br\s*[\/]?>/gi, ' ');
                            var tooltipHtml = 
                                '<span style="color:blue">' + (label && label.length > 0 ? label + ', ' : '') + tickLabel + '</span>: ' +
                                '<strong><span style="color:green;font-size:1.1em">' + yval + '</span></strong>';
                            return tooltipHtml;
                        }
                    }
                };
                for (var li = 0; li < serverData.Labels.length; li++) {
                    options.xaxis.ticks.push([li, serverData.Labels[li]]);
                }
                return options;
            }
            function buildTimeChart(elementId, serverData) {
                var options = buildTimeOptions(serverData);
                var series = buildTimeSeries(serverData);
                $(elementId).plot(series, options);
                $(elementId + '_container').resizable({
                    maxHeight: 2000,
                    minWidth: 500,
                    minHeight: 250
                });
                $(elementId).bind('plotselected', function (event, ranges) {
                    event.stopPropagation();
                    var selectionData = {
                        From: moment.utc(parseInt(ranges.xaxis.from)).format('YYYY-MM-DD HH:mm:ss'),
                        To: moment.utc(parseInt(ranges.xaxis.to)).format('YYYY-MM-DD HH:mm:ss')
                    };
                    $scope.$emit($scope.uidl.qualifiedName + ':RangeSelected', selectionData);
                });
                $(elementId).bind("plotclick", function (event, pos, item) {
                    if (item) { 
                        var serverSeries = serverData.Series[item.seriesIndex];
                        var t0 = serverSeries.Points[item.dataIndex * 2];
                        var t1 = t0 + serverSeries.MillisecondStepSize;
                        var selectionData = {
                            From: moment.utc(t0).format('YYYY-MM-DD HH:mm:ss'),
                            To: moment.utc(t1).format('YYYY-MM-DD HH:mm:ss'),
                            SeriesIndex: item.seriesIndex
                        };
                        $scope.$emit($scope.uidl.qualifiedName + ':RangeSelected', selectionData);
                    }
                });
                $scope.$on("$destroy", function() {
                    $(elementId).unbind();
                });
            }
            function buildTimeSeries(serverData) {
                var chartSeries = [];
                
                for (var si = 0; si < serverData.Series.length; si++) {
                    var series = {
                        label: serverData.Series[si].Label,
                        data: []
                    };
                    setupSeriesType(serverData.Series[si], series);
                    var pointArray = serverData.Series[si].Points;
                    for (var xi = 0; xi < pointArray.length - 1 ; xi += 2) {
                        series.data.push([pointArray[xi], pointArray[xi+1]]);
                    }
                    chartSeries.push(series);
                }
                
                return chartSeries;
            }
            function getTimeTickFormatString(millisecondStepSize) {
                if (millisecondStepSize < 1000) {
                    return 'HH:mm:ss.SSS';
                }
                if (millisecondStepSize < 60000) {
                    return 'HH:mm:ss';
                }
                if (millisecondStepSize < 3600000) {
                    return 'HH:mm';
                }
                if (millisecondStepSize < 86400000) {
                    return 'DD MMM HH:mm';
                }
                return 'DD MMM';
            }
            function buildTimeOptions(serverData) {
                var options = {
                    series: {
                        lines: {
                            show: true,
                            lineWidth: 1,
                            fill: serverData.Series[0].Type==='Area',
                            fillColor: {
                                colors: [{
                                    opacity: 0.1
                                }, {
                                    opacity: 0.35
                                }]
                            }
                        },
                        shadowSize: 0
                    },
                    xaxis: {
                        tickDecimals: 0,
                        mode: "time",
                    },
                    colors: seriesPalette,
                    grid: {
                        color: "#999999",
                        hoverable: true,
                        clickable: true,
                        tickColor: "#D4D4D4",
                        borderWidth:0
                    },
                    legend: {
                        show: true,
                        position: "nw"
                    //    labelFormatter: function(label, series){
                    //        return '<a class="chart-series-toggle" href="#" data-series-index="'+series.idx+'">AAA:'+label+'</a>';
                    //    }
                    },
                    tooltip: {
                        show: true,
                        xDateFormat: "HH:mm:ss.SSS"
                    },
                    tooltipOpts: {
                        content: function(label, xval, yval, flotItem) {
                            var series = serverData.Series[flotItem.seriesIndex];
                            if (series && (series.Type==='Bar' || series.Type==='StackedBar')) {
                                var formatString = getTimeTickFormatString(series.MillisecondStepSize);
                                var t0 = moment.utc(xval).format(formatString);
                                var t1 = moment.utc(xval + series.MillisecondStepSize).format(formatString);
                                var v1 = $scope.uidlService.formatValue('#,##0', Math.abs(yval));
                                return t0 + ' - ' + t1 + '<br/><strong><span style="color:' + flotItem.series.color +'">' + v1 + ' ' + label + '</span></strong>';
                            }
                            return '<strong>' + label + '</strong>: <span style="color:blue">' + moment.utc(xval).format('HH:mm:ss.SSS') + '</span>, <span style="color:green">' + parseFloat(yval).formatMoney(5, '.', ',') + '</span>';
                        }
                    },
                    selection: {
                        mode: "x"
                    }
                };
                if ($scope.uidl.logarithmicScale) {
                    setupIntegerLogarithmicScale(options, serverData);
                }
                return options;
            }
            function setupSeriesType(serverObj, clientObj) {
                switch (serverObj.Type) {
                    case 'StackedBar': 
                        clientObj.stack = true;
                    case 'Bar': 
                        clientObj.bars = { show: true, align: 'left', fill: 0.6, lineWidth: 0 };
                        clientObj.lines = { show: false, lineWidth: 0 };
                        if (serverObj.MillisecondStepSize && serverObj.MillisecondStepSize > 0) {
                            clientObj.bars.barWidth = serverObj.MillisecondStepSize * 0.95;
                        }
                        break;
                }
            }
            function setupIntegerLogarithmicScale(options, serverData) {
                var ticksArray = buildLog10TicksArray(serverData);//[[-10000, "10,000"],[-1000, "1,000"],[-100, "100"],[0, "0"],[100, "100"],[1000, "1,000"],[10000, "10,000"]];
                //buildLog10TicksArray(serverData);
                options.yaxis = {
                    ticks: ticksArray, 
                    transform: function(v) {
                        var absv = Math.abs(v);
                        var sign = (v < 0 ? -1 : 1);
                        if (absv < 1) {
                            return 0;
                        }
                        if (absv === 1) {
                            return 0.2 * sign;
                        }
                        return Math.log10(absv) * sign;
                    }, 
                    inverseTransform: function (v) { 
                        var absv = Math.abs(v);
                        var sign = (v < 0 ? -1 : 1);
                        if (absv < 0.2) {
                            return 0;
                        }
                        if (absv < 0.3) {
                            return 1 * sign;
                        }
                        return Math.pow(10, absv) * sign; 
                    },
                    tickDecimals: 0,
                    //transform: function (v) { return Math.log(v); },
                    //inverseTransform: function (v) { return Math.exp(v); }
                };
            }
            function buildLog10TicksArray(serverData) {
                var maxValue = 0;
                var minValue = 0;
                for (var si = 0 ; si < serverData.Series.length ; si++) {
                    var series = serverData.Series[si];
                    for (var pi = 1 ; pi < series.Points.length ; pi += 2) {
                        var value = series.Points[pi];
                        if (maxValue === 0 || value > maxValue) {
                            maxValue = value;
                        }
                        if (minValue === 0 || value < minValue) {
                            minValue = value;
                        }
                    }
                }
                var positiveTicks = [];
                var negativeTicks = [];
                var prevTickValue = 0;
                for (var tick = 2 ; ; tick++) {
                    var tickValue = Math.pow(10, tick);
                    if (maxValue >= prevTickValue) {
                        positiveTicks.push(tickValue);
                    }
                    if (minValue <= -prevTickValue) {
                        negativeTicks.push(-tickValue);
                    }
                    if (tickValue >= maxValue && -tickValue <= minValue) {
                        break;
                    }
                    prevTickValue = tickValue;
                }
                var allTicks = [];
                if (minValue < 0) {
                    for (var i = negativeTicks.length - 1; i >= 0; i--) {
                        allTicks.push([
                            negativeTicks[i], 
                            $scope.uidlService.formatValue('#,##0', Math.abs(negativeTicks[i]))
                        ]);
                    }
                }
                allTicks.push([0, '0']);
                if (maxValue > 0) {
                    for (var i = 0; i < positiveTicks.length; i++) {
                        allTicks.push([
                            positiveTicks[i], 
                            $scope.uidlService.formatValue('#,##0', positiveTicks[i])
                        ]);
                    }
                }
                return allTicks;
                //[[-10000, "10,000"],[-1000, "1,000"],[-100, "100"],[0, "0"],[100, "100"],[1000, "1,000"],[10000, "10,000"]],//[-1000,-100,-10,0,10,100,1000,10000],
            }
        }
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - POINT CHART
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/PointChart">   
        <table ng-if="model.State.data" border="1" style="margin-top: 10px; background: white" cellpadding="3" cellspacing="1">
            <tr>
                <td>&nbsp;</td>
                <td>{{model.State.data.series[0].label}}</td>
                <td>{{model.State.data.series[1].label}}</td>
            </tr>
            <tr ng-repeat="label in model.State.data.labels track by $index">
                <td>{{label}}</td>
                <td>{{model.State.data.series[0].values[$index]}}</td>
                <td>{{model.State.data.series[1].values[$index]}}</td>
            </tr>
        </table>
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - TYPE SELECTOR (DEFAULT - COMBO BOX)
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/TypeSelector">
        <form class="form-horizontal">
            <div class="form-group">
                <label class="col-lg-2 control-label">Type</label>
                <div class="col-lg-3">
                    <select ng-options="s.typeName as (s.text | translated) for s in uidl.selections" ng-model="selectedType.name" ng-change="selectedTypeChanged(selectedType.name)" class="form-control m-b"></select>
                </div>
            </div>
        </form>
        <uidl-widget ng-repeat="selection in uidl.selections" ng-if="selectedType.name==selection.typeName" uidl="selection.widget" parent-model="model.entity"></uidl-widget>
    </script>
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - TYPE SELECTOR WITH TABS
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/TypeSelectorWithTabs">
        <div class="tabs-container" style="padding:0;">
            <ul class="nav nav-tabs">
                <li ng-class="{active: selectedTabIndex===$index}" ng-repeat="selection in uidl.selections"><a ng-click="selectTabByIndex($index)">{{translate(selection.text)}}</a></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane" ng-repeat="selection in uidl.selections" ng-class="{active: selectedTabIndex===$index}">
                    <div class="panel-body" style="padding:10px;">
                        <uidl-widget ng-if="selectedTabIndex===$index" uidl="selection.widget"></uidl-widget>
                    </div>
                </div>
            </div>
        </div>
    </script>   
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - TYPE SELECTOR WITH ACCORDION
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/TypeSelectorWithAccordion">
        <div class="panel panel-default" style="border:0;margin:0;" id="{{::uidl.elementName}}">
            <div class="panel-body" ng-show="uidl.emptySelectionText && !selectedType.name">
                {{::translate(uidl.emptySelectionText)}}
            </div>
            <div ng-repeat-start="selection in uidl.selections" class="panel-heading" style="cursor:pointer" ng-click="selectedTypeChanged(selection.typeName)">
                <div class="pull-right">
                    <i ng-if="selection.widget.icon" class="fa fa-{{::selection.widget.icon}} text-success"></i>
                </div>
                <h5 class="panel-title">
                    {{::translate(selection.text)}}
                </h5>
            </div>
            <div ng-repeat-end id="{{::selection.widget.elementName}}" style="padding:0;margin:0">
                <div ng-if="selection.typeName===selectedType.name" class="row" style="padding:30px 20px;">
                    <div class="col-md-12">
                        <uidl-widget uidl="selection.widget"></uidl-widget>
                    </div>
                </div>
            </div>
        </div>
    </script>   
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - TABBED SCREEN PART SET
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/TabbedScreenPartSet">
        <div id="{{::uidl.elementName}}" class="full-height" style="padding:0">
            <div class="tabs-container full-height" style="padding:5px 0 0 0;">
                <ul class="nav nav-tabs" style="padding:0 0 0 5px;">
                    <li ng-class="{active: selectedTabIndex===$index}" 
                        ng-repeat="tab in uidl.tabs"
                        ><a ng-click="selectTabByIndex($index)">{{translate(tab.text)}}</a></li>
                </ul>
                <div class="tab-content" style="position:absolute;top:37px;left:0;right:0;bottom:0;">
                    <div ng-repeat="tab in uidl.tabs" ng-class="{active: selectedTabIndex===$index}" 
                         class="tab-pane" 
                         style="margin:0;padding:15px 0 0 0;position:absolute;top:0;left:0;right:0;bottom:0;background-color:white;">
                         <uidl-screen-part uidl="tab"></uidl-screen-part>
                    </div>
                </div>
            </div>
        </div>
    </script>   
    <script type="text/javascript">
        function initWidget_TabbedScreenPartSet($scope) {
            var tabSkinData = { deltaWindowHeight: 80, zeroPadding: true };
            for (var i = 0; i < $scope.uidl.tabs.length ; i++) {
                $scope.uidl.tabs[i].$skin = tabSkinData;
            }
        }
        /*         
                 function resizeToWindow(elem) {
                        var h = $(window).height() - 30;
                        elem.css({ height: h + 'px' });
                    };
                    $scope.$timeout(function() {
                        var elem = $('#' + $scope.uidl.elementName + ' div.tab-content');
                        resizeToWindow(elem);
                        $(window).resize(function() {
                            resizeToWindow(elem);
                        });
                    });
                }
        */        
    </script>
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - FILTER FORM
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/FilterForm">
        <div class="panel-body" id="filterForm">
            <div class="row">
                <div class="form-group">
                    <div class="col-sm-2" ng-repeat="field in uidl.fields">
                        <label class="control-label">{{ field.propertyName }}</label>
                        <uidl-form-field uidl="field" entity="parentModel.entity" />
                    </div>
                </div>
                <div class="col-sm-1">
                    <div class="ibox-tools"><button id="mediaSearch" type="button" class="btn btn-primary" ng-click="executeSearch()">Search123</button></div>
                </div>
            </div>
        </div>
    </script>   

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - REPORT
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/Report">
        <div class="col-lg-12" style="margin:0;padding:0;">
            <div class="ibox float-e-margins" style="padding-bottom:0;margin:0;">
                <div ng-class="{'compensateZeroPadding': uidl.$skin.zeroPadding}">
                    <uidl-widget uidl="uidl.criteriaForm"></uidl-widget>
                </div>
                <div ng-if="hasVisualization" class="m-b" ng-class="{'compensateZeroPadding': uidl.$skin.zeroPadding}">
                    <uidl-widget uidl="uidl.visualizationChart"></uidl-widget>
                </div>
                <uidl-widget uidl="uidl.resultTable"></uidl-widget>
            </div>
        </div>
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - CHART REPORT
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/ChartReport">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <uidl-widget uidl="uidl.criteriaForm"></uidl-widget>
                <uidl-widget uidl="uidl.summaryChart"></uidl-widget>
            </div>
        </div>
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - CHART TABLE REPORT
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/ChartTableReport">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <uidl-widget uidl="uidl.criteriaForm"></uidl-widget>
                <uidl-widget uidl="uidl.summaryChart"></uidl-widget>
                <uidl-widget uidl="uidl.resultTable"></uidl-widget>
            </div>
        </div>
    </script>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - DASHBOARD
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/Dashboard">
        <div class="row">
            <div class="col-lg-12" ng-repeat="widget in uidl.widgets" ng-if="widget.widgetType=='TransactionForm'" style="text-align:right">
                <uidl-widget uidl="widget"></uidl-widget>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-2" ng-repeat="widget in uidl.widgets" ng-if="widget.widgetType=='Gauge'" style="vertical-align:top;">
                <uidl-widget uidl="widget"></uidl-widget>
            </div>
        </div>
        <div class="row" ng-repeat="widget in uidl.widgets" ng-if="widget.widgetType=='Chart' || widget.widgetType=='StaticTable'">
            <div class="col-lg-12" style="vertical-align:top;">
                <uidl-widget uidl="widget"></uidl-widget>
            </div>
        </div>
    </script>
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    UIDL WIDGET - GRID FIELD
    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <script type="text/ng-template" id="app/uidl-element-template/GridField">
        <div class="layout">
            <span ng-if="property.kind!=='Relation'">{{value}}</span>
            <a ng-if="property.kind==='Relation'">Go to</a>
        </div>
    </script>
        
    <!------ HARD CODED  -------->
    
    <script type="text/ng-template" id="app/uidl-element-template/AffiliateSignUpForm">
        <div class="middle-box text-center loginscreen   animated fadeInDown">
            <div>
                <div>
                    <h1 class="logo-name">AFP</h1>
                </div>
                <h2>Sign Up</h2>
                <p>Apply for an affiliate account.</p>
                <form class="m-t" role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Your Name" required="" ng-model="model.Data.FullName" >
                    </div>
                    <div class="form-group">
                        <input type="email" class="form-control" placeholder="Email" required="" ng-model="model.Data.EmailAddress" >
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Phone Number" required="" ng-model="model.Data.PhoneNumber" >
                    </div>
                    <!--div class="form-group">
                            <div class="checkbox i-checks"><label> <input type="checkbox"><i></i> Agree the terms and policy </label></div>
                    </div-->
                    <button class="btn btn-primary block full-width m-b" ng-click="$emit(uidl.qualifiedName + ':SignUp:Executing')">Apply</button>

                    <!--p class="text-muted text-center"><small>Already have an account?</small></p>
                    <a class="btn btn-sm btn-white btn-block" href="login.html">Login</a-->
                </form>
            </div>
        </div>
    </script>
    
    <!-- Javascript frameworks -->
    <script src="app/skin/assets/js/jquery-2.1.1.js"></script>
    <script src="app/skin/assets/js/jquery-ui-1.10.4.min.js"></script>
    <script src="app/skin/assets/js/bootstrap.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="app/skin/assets/js/inspinia.js"></script>
    <script src="app/skin/assets/js/plugins/pace/pace.min.js"></script>
    <script src="app/skin/assets/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    <script src="app/skin/assets/js/plugins/jquery-jsonview/jquery.jsonview.min.js"></script>

    <!-- Chosen -->
    <script src="app/skin/assets/js/plugins/chosen/chosen.jquery.js"></script>

    <!-- JSKnob -->
    <script src="app/skin/assets/js/plugins/jsKnob/jquery.knob.js"></script>

    <!-- Input Mask-->
    <script src="app/skin/assets/js/plugins/jasny/jasny-bootstrap.min.js"></script>

    <!-- Data picker -->
    <script src="app/skin/assets/js/plugins/datapicker/bootstrap-datepicker.js"></script>

    <!-- NouSlider -->
    <script src="app/skin/assets/js/plugins/nouslider/jquery.nouislider.min.js"></script>

    <!-- Switchery -->
    <script src="app/skin/assets/js/plugins/switchery/switchery.js"></script>

    <!-- IonRangeSlider -->
    <script src="app/skin/assets/js/plugins/ionRangeSlider/ion.rangeSlider.min.js"></script>

    <!-- iCheck -->
    <script src="app/skin/assets/js/plugins/iCheck/icheck.min.js"></script>

    <!-- MENU -->
    <script src="app/skin/assets/js/plugins/metisMenu/jquery.metisMenu.js"></script>

    <!-- Color picker -->
    <script src="app/skin/assets/js/plugins/colorpicker/bootstrap-colorpicker.min.js"></script>

    <!-- Clock picker -->
    <script src="app/skin/assets/js/plugins/clockpicker/clockpicker.js"></script>

    <!-- Image cropper -->
    <script src="app/skin/assets/js/plugins/cropper/cropper.min.js"></script>

    <!-- Date range use moment.js same as full calendar plugin -->
    <script src="app/skin/assets/js/plugins/fullcalendar/moment.min.js"></script>

    <!-- Date range picker -->
    <script src="app/skin/assets/js/plugins/daterangepicker/daterangepicker.js"></script>

    <!-- Date/time picker -->
    <script src="app/skin/assets/js/plugins/datetimepicker/bootstrap-datetimepicker.min.js"></script>

    <!-- jqGrid -->
    <script src="app/skin/assets/js/plugins/jqGrid/i18n/grid.locale-en.js"></script>
    <script src="app/skin/assets/js/plugins/jqGrid/jquery.jqGrid.min.js"></script>

    <!-- Gritter -->
    <link href="app/skin/assets/js/plugins/gritter/jquery.gritter.css" rel="stylesheet">

    <!-- Jquery Validate -->
    <script src="app/skin/assets/js/plugins/validate/jquery.validate.min.js"></script>
    <script src="app/skin/assets/js/plugins/validate/additional-methods.min.js"></script>

    <!-- Data Tables -->
    <!--script src="skin/assets/js/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="skin/assets/js/plugins/dataTables/dataTables.bootstrap.js"></script>
    <script src="skin/assets/js/plugins/dataTables/dataTables.responsive.js"></script>
    <script src="skin/assets/js/plugins/dataTables/dataTables.tableTools.min.js"></script-->

    <script src="app/skin/assets/app/angular-1.3.16/angular.min.js"></script>
    <script src="app/skin/assets/app/angular-1.3.16/angular-sanitize.min.js"></script>
    <!--script src="app/skin/assets/js/plugins/chartJs/Chart.min.js"></script-->
    <script src="app/skin/assets/js/plugins/ui-bootstrap-tpls-0.14.3.min.js"></script>
    <!--script src="app/skin/assets/js/plugins/jquery-ui/jquery-ui.min.js"></script-->

    <!-- Flot -->
    <script src="app/skin/assets/js/plugins/flot/jquery.flot.min.js"></script>
    <script src="app/skin/assets/js/plugins/flot/jquery.flot.tooltip.min.js"></script>
    <script src="app/skin/assets/js/plugins/flot/jquery.flot.resize.min.js"></script>
    <script src="app/skin/assets/js/plugins/flot/jquery.flot.pie.min.js"></script>
    <script src="app/skin/assets/js/plugins/flot/jquery.flot.time.js"></script>
    <script src="app/skin/assets/js/plugins/flot/jquery.flot.selection.min.js"></script>
    <script src="app/skin/assets/js/plugins/flot/jquery.flot.stack.min.js"></script>

    <!-- Multiselect -->
    <script src="app/skin/assets/js/plugins/isteven-multi-select/isteven-multi-select.js"></script>

    <!-- DROPZONE -->
    <script src="app/skin/assets/js/plugins/dropzone/dropzone.js"></script>

    <script src="app/skin/assets/app/linqjs-2.2.0.2/linq.min.js"></script>
    <script src="app/skin/assets/app/toastr/toastr.js"></script>
    <script src="app/base/app.js"></script>
    <script src="app/base/entity.js"></script>
    <script src="app/skin/assets/app/chartjs/chart.js"></script>

    <script src="app/Application.js"></script>
    
    <script>
        $(document).ready(function() {
            toastr.options = {
                closeButton: true,
                progressBar: true,
                showMethod: 'slideDown',
                timeOut: 4000
            };
            
            var isDivGlobalDropdownVisible = false;
            var divGlobalDropdownPopup = $('#global_div_dropdown_popup');
            var divGlobalDropdownContent = null;
            var divGlobalDropdownContentParent = null;
            var divGlobalDropdownEventFocus = null;

            function showGlobalDropdownContent(event) {
                if (!isDivGlobalDropdownVisible) {
                    var targetQ = $(event.target);
                    var toggleQ = targetQ.closest('.global-dropdown-toggle');
                    var toggleOffset = toggleQ.offset();
                    var toggleHeight = toggleQ.height();
                    var toggleWidth = toggleQ.width();
                    
                    divGlobalDropdownEventFocus = toggleQ; 
                    divGlobalDropdownContent = toggleQ.next();
                    divGlobalDropdownContentParent = divGlobalDropdownContent.parent();
                    divGlobalDropdownContent.appendTo(divGlobalDropdownPopup);
                    divGlobalDropdownContent.css({display:'block'});
                    divGlobalDropdownPopup.css({
                        top: '1px', 
                        left: '10%', 
                        width: '100%', 
                        height: '100%', 
                        display: 'block'
                    });
                    isDivGlobalDropdownVisible = true;
                    event.stopPropagation();
                    $('body').on('click', hideGlobalDropdownContent);
                }
            }
            
            function hideGlobalDropdownContent(event) {
                if ($(event.target).parents('#global_div_dropdown_popup').length > 0) {
                    return;
                }
                
                if (isDivGlobalDropdownVisible) {
                    divGlobalDropdownPopup.css({display:'none'});
                    divGlobalDropdownContent.css({display:'none'});
                    divGlobalDropdownContent.appendTo(divGlobalDropdownContentParent);
                    isDivGlobalDropdownVisible = false;
                    event.stopPropagation();
                    $('body').off('click', hideGlobalDropdownContent);

                    divGlobalDropdownEventFocus.parents("tr").focus();
                }
            }

            $('body').on('click', '.global-dropdown-toggle', showGlobalDropdownContent);
        });
        
        angular.module('theApp').run(['$rootScope', 'uidlService', 
        function($rootScope, uidlService) {
            $rootScope.showPopupAlert = function(alertHandle) {
                switch (alertHandle.uidl.type) {
                    case 'Info':
                        toastr.info(uidlService.translate(alertHandle.uidl.text));
                        break;
                    case 'Success':
                        toastr.success(uidlService.translate(alertHandle.uidl.text), null, { timeOut: 2000 });
                        break;
                    case 'Warning':
                        toastr.warning(uidlService.translate(alertHandle.uidl.text));
                        break;
                    case 'Error':
                        toastr.error(
                            '<a data-toggle="modal" data-target="#divModalTechnicalInfo"><i class="fa fa-xs fa-angle-double-right"></i>&nbsp;technical info</a>', 
                            uidlService.translate(alertHandle.uidl.text),
                            { timeOut: 5000 });
                        break;
                }
            };
            $rootScope.showModalAlert = function(alertHandle) {
                switch (alertHandle.uidl.type) {
                    case 'Info':
                        toastr.info(uidlService.translate(alertHandle.uidl.text));
                        break;
                    case 'Success':
                        toastr.success(uidlService.translate(alertHandle.uidl.text), null, { timeOut: 2000 });
                        break;
                    case 'Warning':
                        toastr.warning(uidlService.translate(alertHandle.uidl.text));
                        break;
                    case 'Error':
                        toastr.error(
                            '<a data-toggle="modal" data-target="#divModalTechnicalInfo"><i class="fa fa-xs fa-angle-double-right"></i>&nbsp;technical info</a>', 
                            uidlService.translate(alertHandle.uidl.text),
                            { timeOut: 5000 });
                        break;
                }
            };
            $rootScope.beginBrowserDownload = function(url) {
                document.getElementById('global_iframe_content_download').src = url;
            };
            $rootScope.$watch('uidl', function(newValue, oldValue) {
                if ($rootScope.uidl && !$rootScope.pageCodeSnippetsInserted) {
                    if ($rootScope.uidl.headerNativeSnippet) {
                        var snippetDom = $($rootScope.uidl.headerNativeSnippet);
                        $('body').prepend(snippetDom);
                    }
                    if ($rootScope.uidl.nativeTriggeredSnippets) {
                        for (var i = 0 ; i < $rootScope.uidl.nativeTriggeredSnippets.length ; i++) {
                            var triggeredSnippet = $rootScope.uidl.nativeTriggeredSnippets[i];
                            $rootScope.$on(triggeredSnippet.trigger, function(event, data) {
                                eval(triggeredSnippet.snippet);
                            });
                        }
                    }
                    $rootScope.pageCodeSnippetsInserted = true;
                };
            });
        }]);

        angular.module('theApp').directive('jsonView', ['$timeout', function ($timeout) {
            return {
                link: function ($scope, elem, attrs, ctrl) {
                    $scope.$timeout(function() {
                        var options = { 
                            collapsed: !$scope.uidl.expandedByDefault,
                            nl2br: true
                        };
                        var obj = $scope.parentModel;
                        elem.JSONView(obj, options);
                    });
                }
            }
        }]);

        function getCssRulePropertyValue(stylePropertyName, selector, sheet) {
            var sheets = typeof sheet !== 'undefined' ? [sheet] : document.styleSheets;
            for (var i = 0, l = sheets.length; i < l; i++) {
                var sheet = sheets[i];
                if (!sheet.cssRules) { 
                    continue; 
                }
                for (var j = 0, k = sheet.cssRules.length; j < k; j++) {
                    var rule = sheet.cssRules[j];
                    if (rule.selectorText && rule.selectorText.split(',').indexOf(selector) !== -1) {
                        return rule.style[stylePropertyName];
                    }
                }
            }
            return null;
        }

        
        /*
        function initWidget_Screen($scope) {
            if ($scope.uidl.nativeSnippetBefore) {
                $scope.domNativeSnippetBefore = $($scope.uidl.nativeSnippetBefore);
                $('body').prepend($scope.domNativeSnippetBefore);
                $scope.$on("$destroy", function() {
                    if ($scope.domNativeSnippetBefore) {
                        $scope.domNativeSnippetBefore.remove();
                    }
                });            
            }
        }
        function initWidget_ScreenPart($scope) {
            alert('initWidget_ScreenPart : ' + $scope.uidl.qualifiedName);
        }
        angular.module('theApp').service('skinService', ['$rootScope', '$q', 'uidlService', 
        function($rootScope, $q, uidlService) {
            
            function showPopupAlert(alertHandle) {
                switch (alertHandle.uidl.type) {
                    case 'Info':
                        toastr.info(uidlService.translate(alertHandle.uidl.text));
                        break;
                    case 'Success':
                        toastr.success(uidlService.translate(alertHandle.uidl.text), null, { timeOut: 2000 });
                        break;
                    case 'Warning':
                        toastr.warning(uidlService.translate(alertHandle.uidl.text));
                        break;
                    case 'Error':
                        toastr.error(
                            '<a data-toggle="modal" data-target="#divModalTechnicalInfo"><i class="fa fa-xs fa-angle-double-right"></i>&nbsp;technical info</a>', 
                            uidlService.translate(alertHandle.uidl.text),
                            { timeOut: 5000 });
                        break;
                }
            };

            function showModalAlert(alertHandle) {
                return $q.reject('Not implemented');
            };
            
            return {
                showPopupAlert: showPopupAlert
                showModalAlert: showModalAlert
            };
        }]);
        */
    </script>
</body>
</html>
